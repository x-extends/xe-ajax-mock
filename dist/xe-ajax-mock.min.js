/*!
 * xe-ajax-mock.js v1.5.4
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var H=Array.isArray||function(ac){return ac?ac.constructor===Array:false};function T(ac){return typeof ac==="object"}function A(ac){return typeof ac==="function"}function s(ac){return typeof ac==="string"}function f(ad,ac){return ad>=ac?ad:((ad=ad||0)+Math.round(Math.random()*((ac||9)-ad)))}var d=Object.assign||function(ag){for(var af,ad=1,ac=arguments.length;ad<ac;ad++){af=arguments[ad];for(var ae in af){if(af.hasOwnProperty(ae)){ag[ae]=af[ae]}}}return ag};function p(ag,af,ae){if(ag.forEach){return ag.forEach(af,ae)}for(var ad=0,ac=ag.length||0;ad<ac;ad++){af.call(ae||b,ag[ad],ad,ag)}}function F(ae,af,ad){for(var ac in ae){if(ae.hasOwnProperty(ac)){af.call(ad||this,ae[ac],ac,ae)}}}function i(ad){var ac=[];if(ad){if(Object.keys){return Object.keys(ad)}F(ad,function(af,ae){ac.push(ae)})}return ac}function n(ad){if(Object.values){return ad?Object.values(ad):[]}var ac=[];p(i(ad),function(ae){ac.push(ad[ae])});return ac}function o(ag){var ad=[];for(var af=n(ag),ac=af.length-1;ac>=0;ac--){var ae=ac>0?f(0,ac):0;ad.push(af[ae]);af.splice(ae,1)}return ad}function u(ae,ad){var ac=o(ae);if(arguments.length===1){return ac[0]}if(ad<ac.length){ac.length=ad||0}return ac}function e(){return location.origin||(location.protocol+"//"+location.host)}function y(){var ac=location.pathname;var ad=Q(ac,"/")+1;return e()+(ad===ac.length?ac:ac.substring(0,ad))}function Q(ae,ad){if(A(ae.lastIndexOf)){return ae.lastIndexOf(ad)}else{for(var ac=ae.length-1;ac>=0;ac--){if(ad===ae[ac]){return ac}}}return -1}function ab(ac){var ad=String(ac).match(/(\d+)-(\d+)/);return ad&&ad.length===3?f(parseInt(ad[1]),parseInt(ad[2])):(isNaN(ac)?0:Number(ac))}var h=/(.+)\|(array|random)\(([0-9-]+)\)$/;function x(ad){var ac=null;ac=C(ad,new c());if(T(ac)){var ae=i(ac);if(ae.length===1&&ae[0]==="!return"){ac=ac[ae[0]]}}return ac}function C(ad,ac){if(ad){if(H(ad)){return V(ad,ac)}if(T(ad)){return k(ad,ac)}if(s(ad)){return r(ad,ac)}}return ad}function V(ae,ad){var ac=[];p(ae,function(ah,ag){var af=new c(ad,ae,ah,ag);ac.push(C(ah,af))});return ac}function k(ae,ad){var ac={};F(ae,function(al,aj){var ai=aj.match(h);var ak=null;if(ai&&ai.length===4){aj=ai[1];var ah=ai[2].toLowerCase()==="random";if(ai[2].toLowerCase()==="array"||ah){var af=ab(ai[3]);if(H(al)){if(al.length>af){ak=V(ah?u(al,af):al.slice(0,af));if(ah&&ak.length===1){ak=ak[0]}}else{ak=al}}else{ak=[];for(var ag=0;ag<af;ag++){var am=new c(ad,ak,null,ag);ak.push(C(al,am))}}}}else{ak=C(al,ad);ai=aj.match(/(.+)\|(number|boolean)$/);if(ai&&ai.length===3){aj=ai[1];if(ai[2].toLowerCase()==="number"){ak=parseFloat(ak)}else{if(ai[2].toLowerCase()==="boolean"){ak=ak==="0"?false:Boolean(ak)}}}}ac[aj]=ak});return ac}function c(ad,af,ae,ac){this.$parent=ad;this.$obj=af;this.$value=ae;this.$index=ac}d(c.prototype,{random:f});var a={tStart:"__restArr=[]",tEnd:"return __restArr.join('');",contStart:"__restArr.push('",contEnd:"');\n",contTrimEnd:"'.trim());\n",cStart:"__restArr.push(",cEnd:");\n",simplifyRegExp:/__restArr\.push\('\s*'\);/g};function I(ac){return a.contEnd+ac+a.contStart}function r(ac,ad){var af=ac.replace(/[\r\n\t]/g," ").replace(/{{\s*(.*?)\s*}}/g,function(ah,ag){return I(a.cStart+ag+a.cEnd)});try{af="var "+a.tStart+";with(opts){"+a.contStart+af+a.contEnd+"};"+a.tEnd;return new Function("opts",af.replace(a.simplifyRegExp,""))(ad)}catch(ae){console.error(ae)}return ac}var b=typeof window==="undefined"?this:window;var M={};var L=[];var W={baseURL:y(),template:false,timeout:"20-400",headers:null,error:true,log:true};function w(ac,ae){ac.body=null;try{ac.body=JSON.parse(M[ae])}catch(ad){ac.body=M[ae]}return ac}function R(ad){var ac=this;return new Promise(function(af,ae){if(ad.indexOf("/")===0){ad=e()+ad}else{if(!/\w+:\/{2}.*/.test(ad)){ad=W.baseURL.replace(/\/$/,"")+"/"+ad}}if(M[ad]){af(w(ac,ad))}else{var ag=new XMLHttpRequest();ag.open("GET",ad,true);ag.onreadystatechange=function(){if(ag.readyState===4){if(ag.status<200&&ag.status>=300){if(W.error){console.error("This relative module was not found: "+ad)}}M[ad]=ag.responseText;af(w(ac,ad))}};ag.send()}})}function v(ad,ae,ac){if(ae&&ae.body!==undefined&&ae.status!==undefined){ae.headers=d({},W.headers,ae.headers);d(this,ae)}else{this.status=ac;this.body=ae;this.headers=d({},W.headers)}}d(v.prototype,{require:R});function B(ac,ad){return new Promise(function(af,ae){ac.asyncTimeout=setTimeout(function(){if(A(ac.response)){return af(ac.response(ad,new v(ac,null,200),ac))}return Promise.resolve(ac.response).then(function(ag){af(new v(ac,ag,200))}).catch(function(ag){ae(new v(ac,ag,500))})},ac.time)})}function m(ae,af,ac,ad){if(ae&&af){this.path=ae;this.method=af;this.time=0;this.response=ac;this.options=ad;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}d(m.prototype,{send:function(ad,ae){var ac=this;
this.time=ae.timeout||ab(this.options.timeout);return B(ac,ae).then(function(af){ac.reply(ad,ae,af)})},reply:function(ae,af,ac){if(ae.readyState!==4){var ad=af.getUrl();if(this.options.template===true){ac.body=l(ac.body)}ae.status=ac.status;ae.responseText=ae.response=ac.body?JSON.stringify(ac.body):"";ae.responseHeaders=ac.headers;ae.readyState=4;if(this.options.error&&!af.getPromiseStatus(ae)){console.error(af.method+" "+ad+" "+ae.status)}if(A(ae.onreadystatechange)){ae.onreadystatechange()}if(this.options.log){console.info("[XEAjaxMock] URL: "+ad+"\nMethod: "+af.method+" => Status: "+(ac?ac.status:"canceled")+" => Time: "+this.time+"ms");console.info(ac)}}}});function U(ad){var ac=(ad.getUrl()||"").split(/\?|#/)[0];return L.find(function(af){if((af.jsonp?(af.jsonp===ad.jsonp):true)&&ad.method.toLowerCase()===af.method.toLowerCase()){var ae=false;var ag=[];var ah=ac.match(new RegExp(af.path.replace(/{[^{}]+}/g,function(ai){ag.push(ai.substring(1,ai.length-1));return"([^/]+)"})+"(/.*)?"));af.pathVariable={};ae=ah&&ah.length===ag.length+2&&!ah[ah.length-1];if(ae&&ag.length){p(ag,function(aj,ai){af.pathVariable[aj]=ah[ai+1]})}return ae}})}function O(ae,ac,ad,af){if(H(ae)){p(ae,function(ag){if(ag.path){if(af&&ag.path.indexOf("/")===0){ag.path=e()+ag.path}else{if(af&&/\w+:\/{2}.*/.test(ag.path)){ag.path=ag.path}else{ag.path=ad.replace(/\/$/,"")+"/"+ag.path.replace(/^\//,"")}}if(ag.response){ag.method=String(ag.method||"GET");L.push(new m(ag.path,ag.method,ag.response,ac))}O(ag.children,ac,ag.path)}})}}function N(ac){this._mock=null;this._xhr=null;this._request=ac}d(N.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(ae,ac,ad){this._mock=U(this._request);if(this._mock){this.readyState=1;if(A(this.onreadystatechange)){this.onreadystatechange()}}else{this._xhr=new XMLHttpRequest();this._xhr.open(ae,ac,ad)}},send:function(ac){if(this._mock){this._mock.send(this,this._request)}else{var ae=this._xhr;var ad=this;if(this.ontimeout){ae.ontimeout=this.ontimeout}ae.withCredentials=this.withCredentials;ae.onreadystatechange=function(){ad.status=ae.status;ad.readyState=ae.readyState;ad.response=ae.response;ad.responseText=ae.responseText;ae.getAllResponseHeaders().trim();if(A(ad.onreadystatechange)){ad.onreadystatechange()}};ae.send(ac)}},abort:function(ac){var ad=this;setTimeout(function(){if(ad._mock){if(ad.readyState!==0){clearTimeout(ad._mock.asyncTimeout);ad._mock.reply(ad,ad._request,ac||{status:0,response:""});ad.readyState=0}}else{ad._xhr.abort()}})},setRequestHeader:function(ac,ad){if(this._xhr){this._xhr.setRequestHeader(ac,ad)}},getAllResponseHeaders:function(){if(this._xhr){return this._xhr.getAllResponseHeaders()}var ac="";var ae=this.responseHeaders;if(ae){for(var ad in ae){if(ae.hasOwnProperty(ad)){ac+=ad+": "+ae[ad]+"\n"}}}return ac}});function g(ad,ae){var ac=U(ae);if(ac){ac.time=ae.timeout||ab(ac.options.timeout);return B(ac,ae).then(function(af){var ag=ae.getUrl();if(ae.getPromiseStatus(af)){if(ac.options.template===true){af.body=l(af.body)}b[ae.jsonpCallback](af.body);if(ac.options.log){console.info("[XEAjaxMock] URL: "+ag+"\nMethod: "+ae.method+" => Status: "+(af?af.status:"canceled")+" => Time: "+ac.time+"ms");console.info(af)}}else{ad.onerror({type:"error"});if(ac.options.error){console.error("JSONP "+ag+" "+af.status)}}})}else{document.body.appendChild(ad)}}function X(ad,ae){var ac=U(ae);if(!ac){document.body.removeChild(ad)}}function K(af,ag,ac,ad){var ae=d({},W,ad);O(H(af)?(ad=ag,af):[{path:af,method:ag,response:ac}],ae,ae.baseURL,true);return K}function q(ac){d(W,ac)}function J(ac){ac.setup({getXMLHttpRequest:function(ad){return new N(ad)},sendJSONP:g,sendEndJSONP:X});if(W.log){console.info("[XEAjax] Ready. Detected XEAjaxMock v"+Y)}}function aa(ac){return function(af,ad,ae){return K(af,ac,ad,ae)}}function E(ae,ac,ad){return K(ae,"GET",ac,d({jsonp:"callback"},ad))}var l=x;var z=K;var D=aa("GET");var S=aa("POST");var j=aa("PUT");var t=aa("DELETE");var G=aa("PATCH");var P=aa("HEAD");var Y="1.5.4";function Z(ac){return d(K,ac)}Z({setup:q,install:J,template:l,Mock:z,JSONP:E,GET:D,POST:S,PUT:j,DELETE:t,PATCH:G,HEAD:P,version:Y});K.mixin=Z;return K}));