/*!
 * xe-ajax-mock.js v1.1.1
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var h=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"};function b(v){return typeof v==="function"}function a(w,v){return w>=v?w:((w=w||0)+Math.round(Math.random()*((v||9)-w)))}var k=[];var o={baseURL:location.origin,timeout:"20-400",log:true};function e(w,y,x,v){if(w&&y){this.path=w;this.method=y;this.time=0;this.xhr=x;this.options=v}else{throw new TypeError("path and method cannot be empty")}}Object.assign(e.prototype,{getXHR:function(w){var v=this;return new Promise(function(z,y){if(w.ABORT_STATUS){v.time=0;z({status:0,response:null,headers:null})}else{var x=Date.now();var A=setTimeout(function(){Promise.resolve(b(v.xhr)?v.xhr(w,{status:200,response:null,headers:null}):v.xhr).then(function(B){z(v.getResponse(B,200))}).catch(function(B){y(v.getResponse(B,500))})},v.time);w.resolveMock=function(){v.time=Date.now()-x;clearTimeout(A);z({status:0,response:null,headers:null})}}})},getResponse:function(w,v){if(w&&w.response!==undefined&&w.status!==undefined){return w}return{status:v,response:w,headers:null}},reply:function(x,w){var v=this;this.time=q(this.options.timeout);return this.getXHR(x).then(function(y){w(y);if(v.options.log){console.info("XEMock URL: "+x.getUrl()+"\nMethod: "+x.method.toLocaleUpperCase()+" => Status: "+(y?y.status:"canceled")+" => Time: "+v.time+"ms");console.info(y.response)}})}});function q(v){var w=v.match(/(\d+)-(\d+)/);return w.length===3?a(parseInt(w[1]),parseInt(w[2])):0}function t(w){var v=(w.getUrl()||"").split(/\?|#/)[0];return k.find(function(y){if(w.method.toLowerCase()===y.method.toLowerCase()){var x=false;var z=[];var A=v.match(new RegExp(y.path.replace(/{[^{}]+}/g,function(B){z.push(B.substring(1,B.length-1));return"([^/]+)"})+"(/.*)?"));y.pathVariable={};x=A&&A.length===z.length+2&&!A[A.length-1];if(x&&z.length){z.forEach(function(C,B){y.pathVariable[C]=A[B+1]})}return x}})}function j(x,v,w){if(h(x)){x.forEach(function(y){if(y.path){if(!w){w=/\w+:\/{2}.*/.test(y.path)?"":v.baseURL}y.path=(w?w.replace(/\/$/,"")+"/":"")+y.path.replace(/^\//,"");if(y.xhr){y.method=String(y.method||"get");k.push(new e(y.path,y.method,y.xhr,v))}j(y.children,v,y.path)}})}}function u(w,y,x,v){j(h(w)?(v=y,w):[{path:w,method:y,xhr:x}],Object.assign({},o,v));return u}function l(v){Object.assign(o,v)}var m=false;function i(v){if(!m){m=true;v.interceptor.use(function(y,x){var w=t(y);if(w){y.pathVariable=w.pathVariable;w.reply(y,x)}else{x()}})}}function d(v){return function(x,y,w){return u(x,v,y,w)}}var f=u;var s=d("GET");var c=d("POST");var g=d("PUT");var r=d("DELETE");var p=d("PATCH");function n(v){return Object.assign(u,v)}n({setup:l,install:i,Mock:f,GET:s,POST:c,PUT:g,DELETE:r,PATCH:p});u.mixin=n;return u}));