/*!
 * xe-ajax-mock.js v1.4.6
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var i=Array.isArray||function(D){return D?D.constructor===Array:false};function c(D){return typeof D==="function"}function b(E,D){return E>=D?E:((E=E||0)+Math.round(Math.random()*((D||9)-E)))}var B=Object.assign||function(H){for(var G,E=1,D=arguments.length;E<D;E++){G=arguments[E];for(var F in G){if(G.hasOwnProperty(F)){H[F]=G[F]}}}return H};function p(H,G,F){if(H.forEach){return H.forEach(G,F)}for(var E=0,D=H.length||0;E<D;E++){G.call(F||s,H[E],E,H)}}var s=typeof window==="undefined"?this:window;var o=[];var r={baseURL:location.origin,timeout:"20-400",headers:null,error:true,log:true};function a(D,E){return new Promise(function(G,F){D.asyncTimeout=setTimeout(function(){Promise.resolve(c(D.response)?D.response(E,D.getResponse(null,200),D):D.response).then(function(H){G(D.getResponse(H,200))})["catch"](function(H){F(D.getResponse(H,500))})},D.time)})}function f(F,G,D,E){if(F&&G){this.path=F;this.method=G;this.time=0;this.response=D;this.options=E;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}B(f.prototype,{getResponse:function(E,D){if(E&&E.body!==undefined&&E.status!==undefined){E.headers=B({},r.headers,E.headers);return E}return{status:D,body:E,headers:B({},r.headers)}},send:function(E,F){var D=this;this.time=F.timeout||w(this.options.timeout);return a(D,F).then(function(G){D.reply(E,F,G)})},reply:function(F,G,D){if(F.readyState!==4){var E=G.getUrl();F.status=D.status;F.responseText=F.response=D.body?JSON.stringify(D.body):"";F.responseHeaders=D.headers;F.readyState=4;if(this.options.error&&!G.getPromiseStatus(F)){console.error(G.method+" "+E+" "+F.status)}if(c(F.onreadystatechange)){F.onreadystatechange()}if(this.options.log){console.info("XEMock URL: "+E+"\nMethod: "+G.method+" => Status: "+(D?D.status:"canceled")+" => Time: "+this.time+"ms");console.info(D.body)}}}});function w(D){var E=D.match(/(\d+)-(\d+)/);return E.length===3?b(parseInt(E[1]),parseInt(E[2])):0}function A(E){var D=(E.getUrl()||"").split(/\?|#/)[0];return o.find(function(G){if((G.jsonp?(G.jsonp===E.jsonp):true)&&E.method.toLowerCase()===G.method.toLowerCase()){var F=false;var H=[];var I=D.match(new RegExp(G.path.replace(/{[^{}]+}/g,function(J){H.push(J.substring(1,J.length-1));return"([^/]+)"})+"(/.*)?"));G.pathVariable={};F=I&&I.length===H.length+2&&!I[I.length-1];if(F&&H.length){p(H,function(K,J){G.pathVariable[K]=I[J+1]})}return F}})}function n(F,D,E){if(i(F)){p(F,function(G){if(G.path){if(!E){E=/\w+:\/{2}.*/.test(G.path)?"":D.baseURL}G.path=(E?E.replace(/\/$/,"")+"/":"")+G.path.replace(/^\//,"");if(G.response){G.method=String(G.method||"get");o.push(new f(G.path,G.method,G.response,D))}n(G.children,D,G.path)}})}}function z(D){this._mock=null;this._xhr=null;this._request=D}B(z.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(F,D,E){this._mock=A(this._request);if(this._mock){this.readyState=1;if(c(this.onreadystatechange)){this.onreadystatechange()}}else{this._xhr=new XMLHttpRequest();this._xhr.open(F,D,E)}},send:function(D){if(this._mock){this._mock.send(this,this._request)}else{var F=this._xhr;var E=this;if(this.ontimeout){F.ontimeout=this.ontimeout}F.withCredentials=this.withCredentials;F.onreadystatechange=function(){E.status=F.status;E.readyState=F.readyState;E.response=F.response;E.responseText=F.responseText;F.getAllResponseHeaders().trim();if(c(E.onreadystatechange)){E.onreadystatechange()}};F.send(D)}},abort:function(D){var E=this;setTimeout(function(){if(E._mock){if(E.readyState!==0){clearTimeout(E._mock.asyncTimeout);E._mock.reply(E,E._request,D||{status:0,response:""});E.readyState=0}}else{E._xhr.abort()}})},setRequestHeader:function(D,E){if(this._xhr){this._xhr.setRequestHeader(D,E)}},getAllResponseHeaders:function(){if(this._xhr){return this._xhr.getAllResponseHeaders()}var D="";var F=this.responseHeaders;if(F){for(var E in F){if(F.hasOwnProperty(E)){D+=E+": "+F[E]+"\n"}}}return D}});function j(E,F){var D=A(F);if(D){D.time=F.timeout||w(D.options.timeout);return a(D,F).then(function(G){var H=F.getUrl();if(F.getPromiseStatus(G)){s[F.jsonpCallback](G.body);if(D.options.log){console.info("XEMock URL: "+H+"\nMethod: "+F.method+" => Status: "+(G?G.status:"canceled")+" => Time: "+D.time+"ms");console.info(G.body)}}else{E.onerror({type:"error"});if(D.options.error){console.error("JSONP "+H+" "+G.status)}}})}else{document.body.appendChild(E)}}function v(E,F){var D=A(F);if(!D){document.body.removeChild(E)}}function C(F,G,D,E){n(i(F)?(E=G,F):[{path:F,method:G,response:D}],B({},r,E));return C}function m(D){B(r,D)}function l(D){D.setup({getXMLHttpRequest:function(E){return new z(E)},sendJSONP:j,sendEndJSONP:v});if(r.log){console.info("[XEAjax] Ready. Detected XEAjaxMock v"+e)
}}function u(D){return function(G,E,F){return C(G,D,E,F)}}function k(F,D,E){return C(F,"GET",D,B({jsonp:"callback"},E))}var g=C;var y=u("GET");var d=u("POST");var h=u("PUT");var x=u("DELETE");var t=u("PATCH");var e="1.4.6";function q(D){return B(C,D)}q({setup:m,install:l,JSONP:k,Mock:g,GET:y,POST:d,PUT:h,DELETE:x,PATCH:t,version:e});C.mixin=q;return C}));