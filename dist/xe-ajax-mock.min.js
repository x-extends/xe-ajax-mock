/*!
 * xe-ajax-mock.js v1.4.2
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){function c(z){return typeof z==="function"}function b(A,z){return A>=z?A:((A=A||0)+Math.round(Math.random()*((z||9)-A)))}var p=typeof window==="undefined"?this:window;var l=[];var o={baseURL:location.origin,timeout:"20-400",headers:null,error:true,log:true};function a(z,A){return new Promise(function(C,B){z.asyncTimeout=setTimeout(function(){Promise.resolve(c(z.response)?z.response(A,z.getResponse(null,200),z):z.response).then(function(D){C(z.getResponse(D,200))})["catch"](function(D){B(z.getResponse(D,500))})},z.time)})}function e(B,C,z,A){if(B&&C){this.path=B;this.method=C;this.time=0;this.response=z;this.options=A;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}Object.assign(e.prototype,{getResponse:function(A,z){if(A&&A.body!==undefined&&A.status!==undefined){A.headers=Object.assign({},o.headers,A.headers);return A}return{status:z,body:A,headers:Object.assign({},o.headers)}},send:function(A,B){var z=this;this.time=B.timeout||t(this.options.timeout);return a(z,B).then(function(C){z.reply(A,B,C)})},reply:function(B,C,z){if(B.readyState!==4){var A=C.getUrl();B.status=z.status;B.responseText=B.response=z.body?JSON.stringify(z.body):"";B.responseHeaders=z.headers;B.readyState=4;if(this.options.error&&!C.getPromiseStatus(B)){console.error(C.method+" "+A+" "+B.status)}if(c(B.onreadystatechange)){B.onreadystatechange()}if(this.options.log){console.info("XEMock URL: "+A+"\nMethod: "+C.method+" => Status: "+(z?z.status:"canceled")+" => Time: "+this.time+"ms");console.info(z.body)}}}});function t(z){var A=z.match(/(\d+)-(\d+)/);return A.length===3?b(parseInt(A[1]),parseInt(A[2])):0}function x(A){var z=(A.getUrl()||"").split(/\?|#/)[0];return l.find(function(C){if((C.jsonp?(C.jsonp===A.jsonp):true)&&A.method.toLowerCase()===C.method.toLowerCase()){var B=false;var D=[];var E=z.match(new RegExp(C.path.replace(/{[^{}]+}/g,function(F){D.push(F.substring(1,F.length-1));return"([^/]+)"})+"(/.*)?"));C.pathVariable={};B=E&&E.length===D.length+2&&!E[E.length-1];if(B&&D.length){D.forEach(function(G,F){C.pathVariable[G]=E[F+1]})}return B}})}function k(B,z,A){if(Array.isArray(B)){B.forEach(function(C){if(C.path){if(!A){A=/\w+:\/{2}.*/.test(C.path)?"":z.baseURL}C.path=(A?A.replace(/\/$/,"")+"/":"")+C.path.replace(/^\//,"");if(C.response){C.method=String(C.method||"get");l.push(new e(C.path,C.method,C.response,z))}k(C.children,z,C.path)}})}}function w(z){this.XEMock_MATE=null;this.XEMock_XHR=null;this.XEMock_REQUEST=z}Object.assign(w.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(B,z,A){this.XEMock_MATE=x(this.XEMock_REQUEST);if(this.XEMock_MATE){this.readyState=1;if(c(this.onreadystatechange)){this.onreadystatechange()}}else{this.XEMock_XHR=new XMLHttpRequest();this.XEMock_XHR.open(B,z,A)}},send:function(z){if(this.XEMock_MATE){this.XEMock_MATE.send(this,this.XEMock_REQUEST)}else{this.XEMock_XHR.withCredentials=this.withCredentials;this.XEMock_XHR.send(z)}},abort:function(z){var A=this;setTimeout(function(){if(A.XEMock_MATE){if(A.readyState!==0){clearTimeout(A.XEMock_MATE.asyncTimeout);A.XEMock_MATE.reply(A,A.XEMock_REQUEST,z||{status:0,response:""});A.readyState=0}}else{A.XEMock_XHR.abort()}})},setRequestHeader:function(z,A){if(this.XEMock_XHR){this.XEMock_XHR.setRequestHeader(z,A)}},getAllResponseHeaders:function(){var z="";var B=this.responseHeaders;if(B){for(var A in B){if(B.hasOwnProperty(A)){z+=A+": "+B[A]+"\n"}}}return z}});function h(A,B){var z=x(B);if(z){z.time=B.timeout||t(z.options.timeout);return a(z,B).then(function(C){var D=B.getUrl();if(B.getPromiseStatus(C)){p[B.jsonpCallback](C.body);if(z.options.log){console.info("XEMock URL: "+D+"\nMethod: "+B.method+" => Status: "+(C?C.status:"canceled")+" => Time: "+z.time+"ms");console.info(C.body)}}else{A.onerror({type:"error"});if(z.options.error){console.error("JSONP "+D+" "+C.status)}}})}else{document.body.appendChild(A)}}function s(A,B){var z=x(B);if(!z){document.body.removeChild(A)}}function y(B,C,z,A){k(Array.isArray(B)?(A=C,B):[{path:B,method:C,response:z}],Object.assign({},o,A));return y}function m(z){Object.assign(o,z)}function j(z){z.setup({getXMLHttpRequest:function(A){return new w(A)},sendJSONP:h,sendEndJSONP:s})}function r(z){return function(C,A,B){return y(C,z,A,B)}}function i(B,z,A){return y(B,"GET",z,Object.assign({jsonp:"callback"},A))}var f=y;var v=r("GET");var d=r("POST");var g=r("PUT");var u=r("DELETE");var q=r("PATCH");function n(z){return Object.assign(y,z)}n({setup:m,install:j,JSONP:i,Mock:f,GET:v,POST:d,PUT:g,DELETE:u,PATCH:q});y.mixin=n;return y}));