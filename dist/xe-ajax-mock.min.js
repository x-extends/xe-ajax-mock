/**
 * xe-ajax-mock.js v1.6.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 * @preserve
 */
!function(t,e){"object"==typeof s&&"undefined"!=typeof module?module.s=e():"function"==typeof define&&define.amd?define(e):t.XEAjaxMock=e()}(this,function(){"use strict";function t(t){return!!t&&t.constructor===Date}function e(t){return"object"==typeof t}function n(t){return"function"==typeof t}function r(t){return"string"==typeof t}function o(t,e){return t>=e?t:(t=t||0)+Math.round(Math.random()*((e||9)-t))}function s(e,n){if(e){if(t(e))return e;if(!isNaN(e))return new Date(e);if(r(e)){n=n||"yyyy-MM-dd HH:mm:ss.SSS";var o=[];return i([{rules:[["yyyy",4],["yyy",3],["yy",2]]},{rules:[["MM",2],["M",1]],offset:-1},{rules:[["dd",2],["d",1]]},{rules:[["HH",2],["H",1]]},{rules:[["mm",2],["m",1]]},{rules:[["ss",2],["s",1]]},{rules:[["SSS",3],["SS",2],["S",1]]}],function(t){for(var r,s,i=0,a=t.rules,u=a.length;i<u;i++){if(r=a[i],(s=n.indexOf(r[0]))>-1){o.push(parseFloat(e.substring(s,s+r[1])||0)+(t.offset||0));break}i===u-1&&o.push(0)}}),new Date(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}}return"Invalid Date"}function i(t,e,n){if(t.forEach)return t.forEach(e,n);for(var r=0,o=t.length||0;r<o;r++)e.call(n||global,t[r],r,t)}function a(t,e,n){for(var r in t)t.hasOwnProperty(r)&&e.call(n||this,t[r],r,t)}function u(t){var e=[];if(t){if(Object.keys)return Object.keys(t);a(t,function(t,n){e.push(n)})}return e}function c(t){for(var e=[],n=function(t){if(Object.values)return t?Object.values(t):[];var e=[];return i(u(t),function(n){e.push(t[n])}),e}(t),r=n.length-1;r>=0;r--){var s=r>0?o(0,r):0;e.push(n[s]),n.splice(s,1)}return e}function h(t,e){var n=c(t);return 1===arguments.length?n[0]:(e<n.length&&(n.length=e||0),n)}function l(){return location.origin||location.protocol+"//"+location.host}function f(t){var e=String(t).match(/(\d+)-(\d+)/);return e&&3===e.length?o(parseInt(e[1]),parseInt(e[2])):isNaN(t)?0:Number(t)}function p(t,e){var n=t.replace(/[\r\n\t]/g," ").replace(/{{\s*(.*?)\s*}}/g,function(t,e){return function(t){return L.contEnd+t+L.contStart}(L.cStart+e+L.cEnd)});try{return n="var "+L.tStart+";with(opts){"+L.contStart+n+L.contEnd+"};"+L.tEnd,new Function("opts",n.replace(L.simplifyRegExp,""))(e)}catch(t){console.error(t)}return t}function d(t){var n=null;if(n=m(t,new g),e(n)){var r=u(n);1===r.length&&"!return"===r[0]&&(n=n[r[0]])}return n}function m(t,n){if(t){if(A(t))return y(t,n);if(e(t))return function(t,e){var n={};return a(t,function(t,r){var o=r.match(C),s=null;if(o&&4===o.length){r=o[1];var i="random"===o[2].toLowerCase();if("array"===o[2].toLowerCase()||i){var a=f(o[3]);if(A(t))t.length>a?(s=y(i?h(t,a):t.slice(0,a),e),i&&1===s.length&&(s=s[0])):s=y(t,e);else{s=[];for(var u=0;u<a;u++){var c=new g(e,s,null,u);s.push(m(t,c))}}}}else s=m(t,e),(o=r.match(/(.+)\|(number|boolean)$/))&&3===o.length&&(r=o[1],"number"===o[2].toLowerCase()?s=parseFloat(s):"boolean"===o[2].toLowerCase()&&(s="0"!==s&&Boolean(s)));n[r]=s}),n}(t,n);if(r(t))return p(t,n)}return t}function y(t,e){var n=[];return i(t,function(r,o){var s=new g(e,t,r,o);n.push(m(r,s))}),n}function g(t,e,n,r){this.$parent=t,this.$obj=e,this.$value=n,this.$index=r}function v(t){return O(g.prototype,t)}function b(t,e){var n=e._request,r=j(n);return r?(r.time=f(r.options.timeout),T(r,n).then(function(n){return r.options.log&&(console.info("[XEAjaxMock] URL: "+t+"\nMethod: "+e.method+" => Status: "+(n?n.status:"canceled")+" => Time: "+r.time+"ms"),console.info(n)),n})):fetch(t,e)}function S(){this._mock=null,this._xhr=null}function x(t,e,n,r){var o=j(e);if(P[e.jsonpCallback]=function(t){n({status:200,body:t})},o)return o.time=f(o.options.timeout),T(o,e).then(function(n){var r=e.getUrl();e.validateStatus(n)?(!0===o.options.template&&(n.body=d(n.body)),P[e.jsonpCallback](n.body),o.options.log&&(console.info("[XEAjaxMock] URL: "+r+"\nMethod: "+e.method+" => Status: "+(n?n.status:"canceled")+" => Time: "+o.time+"ms"),console.info(n))):(t.onerror({type:"error"}),o.options.error&&console.error("JSONP "+r+" "+n.status))});var s=e.getUrl();t.type="text/javascript",t.src=s+(-1===s.indexOf("?")?"?":"&")+e.jsonp+"="+e.jsonpCallback,t.onerror=function(t){n({status:500,body:""})},t.onabort=function(t){n({status:0,body:""})},e.timeout&&setTimeout(function(){t.onabort()},e.timeout),document.body.appendChild(t)}function E(t,e){t.body=null;try{t.body=JSON.parse(q[e])}catch(n){t.body=q[e]}return t}function w(t,e,n){e&&void 0!==e.body&&void 0!==e.status?(e.headers=O({},D.headers,e.headers),O(this,e)):(this.status=n,this.body=e,this.headers=O({},D.headers))}function T(t,e){return new Promise(function(r,o){t.asyncTimeout=setTimeout(function(){if(!e.$complete)return n(t.response)?r(t.response(e,new w(t,null,200),t)):Promise.resolve(t.response).then(function(e){r(new w(t,e,200))}).catch(function(e){o(new w(t,e,500))})},t.time)})}function _(t,e,n,r){t&&e?(this.path=t,this.method=e,this.time=0,this.response=n,this.options=r,this.asyncTimeout=null):this.options.error&&console.error("path and method cannot be empty")}function M(t,e,n,r){A(t)&&i(t,function(t){t.path&&(r&&0===t.path.indexOf("/")?t.path=l()+t.path:r&&/\w+:\/{2}.*/.test(t.path)?t.path=t.path:t.path=n.replace(/\/$/,"")+"/"+t.path.replace(/^\//,""),t.response&&(t.method=String(t.method||"GET"),U.push(new _(t.path,t.method,t.response,e))),M(t.children,e,t.path))})}function j(t){var e=(t.getUrl()||"").split(/\?|#/)[0];return U.find(function(n){if((!n.jsonp||n.jsonp===t.jsonp)&&t.method.toLowerCase()===n.method.toLowerCase()){var r=!1,o=[],s=e.match(new RegExp(n.path.replace(/{[^{}]+}/g,function(t){return o.push(t.substring(1,t.length-1)),"([^/]+)"})+"/?$"));return n.pathVariable={},(r=s&&s.length===o.length+1)&&o.length&&i(o,function(t,e){n.pathVariable[t]=s[e+1]}),r}})}function H(t,e,n,r){var o=O({},D,r);return M(A(t)?(r=e,t):[{path:t,method:e,response:n}],o,o.baseURL,!0),H}function R(t){return function(e,n,r){return H(e,t,n,r)}}function k(t){return O(H,t)}var A=Array.isArray||function(t){return!!t&&t.constructor===Array},O=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t},$={random:{num:o,time:function(t,e){return o(s(t).getTime(),s(e).getTime())},date:function(e,n,r){return function(e,n){if(e=s(e),t(e)){var r=n||"yyyy-MM-dd HH:mm:ss",o=["日","一","二","三","四","五","六"],a={"q+":Math.floor((e.getMonth()+3)/3),"M+":e.getMonth()+1,"E+":e.getDay(),"d+":e.getDate(),"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),S:e.getMilliseconds()};return/(y+)/.test(r)&&(r=r.replace(RegExp.$1,(""+e.getFullYear()).substr(4-RegExp.$1.length))),i(u(a),function(t){if(new RegExp("("+t+")").test(r)){var e=""+a[t];r=r.replace(RegExp.$1,"q+"===t||"E+"===t?o[e]:1===RegExp.$1.length?e:("00"+e).substr(e.length))}}),r}return e}($.random.time(e,n),r)},repeat:function(t,e,n){if(e=e||1,n=n||e,r(t)&&(t=t.split("")),t.length<n){for(var s=t;s.length<n;)s=s.concat(t);s.length=n,t=s}return h(t,o(e,n)).join("")}}},L={tStart:"__restArr=[]",tEnd:"return __restArr.join('');",contStart:"__restArr.push('",contEnd:"');\n",contTrimEnd:"'.trim());\n",cStart:"__restArr.push(",cEnd:");\n",simplifyRegExp:/__restArr\.push\('\s*'\);/g},C=/(.+)\|(array|random)\(([0-9-]+)\)$/;d.mixin=v,v($),O(S.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:!1,response:"",responseText:"",open:function(t,e,r){this._mock=j(this._request),this._mock?(this.readyState=1,n(this.onreadystatechange)&&this.onreadystatechange()):(this._xhr=new XMLHttpRequest,this._xhr.open(t,e,r))},send:function(t){if(this._mock)this._mock.send(this,this._request);else{var e=this._xhr,r=this;e.withCredentials=this.withCredentials,e.onreadystatechange=function(){r.status=e.status,r.readyState=e.readyState,r.response=e.response,r.responseText=e.responseText,e.getAllResponseHeaders().trim(),n(r.onreadystatechange)&&r.onreadystatechange()},e.send(t)}},abort:function(t){var e=this;setTimeout(function(){e._mock?0!==e.readyState&&(clearTimeout(e._mock.asyncTimeout),e._mock.reply(e,e._request,t||{status:0,response:""}),e.readyState=0):e._xhr&&e._xhr.abort()})},setRequestHeader:function(t,e){this._xhr&&this._xhr.setRequestHeader(t,e)},getAllResponseHeaders:function(){if(this._xhr)return this._xhr.getAllResponseHeaders();var t="",e=this.responseHeaders;if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+": "+e[n]+"\n");return t}});var P="undefined"==typeof window?this:window,q={};O(w.prototype,{require:function(t){var e=this;return new Promise(function(n,r){if(0===t.indexOf("/")?t=l()+t:/\w+:\/{2}.*/.test(t)||(t=D.baseURL.replace(/\/$/,"")+"/"+t),q[t])n(E(e,t));else{var o=new XMLHttpRequest;o.open("GET",t,!0),o.onreadystatechange=function(){4===o.readyState&&(o.status<200&&o.status>=300&&D.error&&console.error("This relative module was not found: "+t),q[t]=o.responseText,n(E(e,t)))},o.send()}})}});var U=[],D={baseURL:function(){var t=location.pathname,e=function(t,e){if(n(t.lastIndexOf))return t.lastIndexOf(e);for(var r=t.length-1;r>=0;r--)if(e===t[r])return r;return-1}(t,"/")+1;return l()+(e===t.length?t:t.substring(0,e))}(),template:!1,timeout:"20-400",headers:null,error:!0,log:!1};O(_.prototype,{send:function(t,e){var n=this;return this.time=f(this.options.timeout),T(n,e).then(function(r){n.reply(t,e,r)})},reply:function(t,e,r){if(4!==t.readyState){var o=e.getUrl();!0===this.options.template&&(r.body=N(r.body)),t.status=r.status,t.responseText=t.response=r.body?JSON.stringify(r.body):"",t.responseHeaders=r.headers,t.readyState=4,this.options.error&&(t.status<200||t.status>=300)&&console.error(e.method+" "+o+" "+t.status),n(t.onreadystatechange)&&t.onreadystatechange(),this.options.log&&(console.info("[XEAjaxMock] URL: "+o+"\nMethod: "+e.method+" => Status: "+(r?r.status:"canceled")+" => Time: "+this.time+"ms"),console.info(r))}}});var N=d,X=H,G=R("GET"),I=R("POST"),F=R("PUT"),J=R("DELETE"),V=R("PATCH"),B=R("HEAD"),Y={template:N,Mock:X,JSONP:function(t,e,n){return H(t,"GET",e,O({jsonp:"callback"},n))},HEAD:B,GET:G,POST:I,PUT:F,DELETE:J,PATCH:V};return O(H,{mixin:k,setup:function(t){O(D,t)},install:function(t){t.setup({$fetch:b,$XMLHttpRequest:S,$jsonp:x})},version:"1.6.0",$name:"XEAjaxMock"}),k(Y),H});