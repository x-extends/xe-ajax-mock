/**
 * xe-ajax-mock.js v1.6.4
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XEAjaxMock=e()}(this,function(){"use strict";function t(t){return!!t&&t.constructor===Date}function e(t){return"object"==typeof t}function n(t){return"function"==typeof t}function r(t){return"string"==typeof t}function o(t,e){return t>=e?t:(t=t||0)+Math.round(Math.random()*((e||9)-t))}function s(e,n){if(e){if(t(e))return e;if(!isNaN(e))return new Date(e);if(r(e)){n=n||"yyyy-MM-dd HH:mm:ss.SSS";var o=[];return i(O,function(t){for(var r,s,a=0,i=t.rules,u=i.length;a<u;a++){if(r=i[a],(s=n.indexOf(r[0]))>-1){o.push(parseFloat(e.substring(s,s+r[1])||0)+(t.offset||0));break}a===u-1&&o.push(0)}}),new Date(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}}return"Invalid Date"}function a(e,n){if(e=s(e),t(e)){var r=n||"yyyy-MM-dd HH:mm:ss",o=["日","一","二","三","四","五","六"],a={"q+":Math.floor((e.getMonth()+3)/3),"M+":e.getMonth()+1,"E+":e.getDay(),"d+":e.getDate(),"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),S:e.getMilliseconds()};return/(y+)/.test(r)&&(r=r.replace(RegExp.$1,(""+e.getFullYear()).substr(4-RegExp.$1.length))),i(c(a),function(t){if(new RegExp("("+t+")").test(r)){var e=""+a[t];r=r.replace(RegExp.$1,"q+"===t||"E+"===t?o[e]:1===RegExp.$1.length?e:("00"+e).substr(e.length))}}),r}return e}function i(t,e,n){if(t.forEach)return t.forEach(e,n);for(var r=0,o=t.length||0;r<o;r++)e.call(n||global,t[r],r,t)}function u(t,e,n){for(var r in t)t.hasOwnProperty(r)&&e.call(n||this,t[r],r,t)}function c(t){var e=[];if(t){if(Object.keys)return Object.keys(t);u(t,function(t,n){e.push(n)})}return e}function h(t){for(var e=[],n=function(t){if(Object.values)return t?Object.values(t):[];var e=[];return i(c(t),function(n){e.push(t[n])}),e}(t),r=n.length-1;r>=0;r--){var s=r>0?o(0,r):0;e.push(n[s]),n.splice(s,1)}return e}function l(t,e){var n=h(t);return 1===arguments.length?n[0]:(e<n.length&&(n.length=e||0),n)}function f(){return location.origin||location.protocol+"//"+location.host}function p(t){var e=String(t).match(/(\d+)-(\d+)/);return e&&3===e.length?o(parseInt(e[1]),parseInt(e[2])):isNaN(t)?0:Number(t)}function d(t,e){var n=t.replace(/[\r\n\t]/g," ").replace(/{{\s*(.*?)\s*}}/g,function(t,e){return function(t){return P.contEnd+t+P.contStart}(P.cStart+e+P.cEnd)});try{return n="var "+P.tStart+";with(opts){"+P.contStart+n+P.contEnd+"};"+P.tEnd,new Function("opts",n.replace(P.simplifyRegExp,""))(e)}catch(t){console.error(t)}return t}function m(t,n){var r=null;if(r=y(t,new v({},n)),e(r)){var o=c(r);1===o.length&&"!return"===o[0]&&(r=r[o[0]])}return r}function y(t,n){if(t){if(A(t))return g(t,n);if(e(t))return function(t,e){var n={};return u(t,function(t,r){var o=r.match(q),s=null;if(o&&4===o.length){r=o[1];var a="random"===o[2].toLowerCase();if("array"===o[2].toLowerCase()||a){var i=p(o[3]);if(A(t))t.length>i?(s=g(a?l(t,i):t.slice(0,i),e),a&&1===s.length&&(s=s[0])):s=g(t,e);else{s=[];for(var u=0;u<i;u++){var c=new v({$parent:e,$obj:s,$value:null,$size:i,$index:u},e.$fns);s.push(y(t,c))}}}}else s=y(t,e),(o=r.match(/(.+)\|(number|boolean)$/))&&3===o.length&&(r=o[1],"number"===o[2].toLowerCase()?s=parseFloat(s):"boolean"===o[2].toLowerCase()&&(s="0"!==s&&Boolean(s)));n[r]=s}),n}(t,n);if(r(t))return d(t,n)}return t}function g(t,e){var n=[];return i(t,function(r,o){var s=new v({$parent:e,$obj:t,$value:r,$size:t.length,$index:o},e.$fns);n.push(y(r,s))}),n}function v(t,e){this.$fns=e,L(this,e,t)}function b(t){return L(v.prototype,t)}function x(t,e){var n=e._request,r=j(n);return r?(r.time=p(r.options.timeout),_(r,n).then(function(n){return r.options.log&&(console.info("[XEAjaxMock] URL: "+t+"\nMethod: "+e.method+" => Status: "+(n?n.status:"canceled")+" => Time: "+r.time+"ms"),console.info(n)),n})):fetch(t,e)}function S(){this._mock=null,this._xhr=null}function E(t,e,n,r){var o=j(e);if(U[e.jsonpCallback]=function(t){n({status:200,body:t})},o)return o.time=p(o.options.timeout),_(o,e).then(function(n){var r=e.getUrl();e.validateStatus(n)?(U[e.jsonpCallback](n.body),o.options.log&&(console.info("[XEAjaxMock] URL: "+r+"\nMethod: "+e.method+" => Status: "+(n?n.status:"canceled")+" => Time: "+o.time+"ms"),console.info(n))):(t.onerror({type:"error"}),o.options.error&&console.error("JSONP "+r+" "+n.status))});var s=e.getUrl();t.type="text/javascript",t.src=s+(-1===s.indexOf("?")?"?":"&")+e.jsonp+"="+e.jsonpCallback,t.onerror=function(t){n({status:500,body:""})},t.onabort=function(t){n({status:0,body:""})},e.timeout&&setTimeout(function(){t.onabort()},e.timeout),document.body.appendChild(t)}function w(t,e){t.body=null;try{t.body=JSON.parse(N[e])}catch(n){t.body=N[e]}return t}function T(t,e,n,r){n&&!0===t.options.template&&(n=V(n,{$pathVariable:t.pathVariable,$params:e.params||{},$body:e.body||{}})),n&&void 0!==n.body&&void 0!==n.status?(n.headers=L({},t.options.headers,n.headers),L(this,n)):(this.status=r,this.body=n,this.headers=L({},t.options.headers))}function _(t,e){return new Promise(function(r,o){t.asyncTimeout=setTimeout(function(){if(!e.$complete)return n(t.response)?r(t.response(e,new T(t,e,null,200),t)):Promise.resolve(t.response).then(function(n){r(new T(t,e,n,200))}).catch(function(n){o(new T(t,e,n,500))})},t.time)})}function $(t,e,n,r){t&&e?(this.path=t,this.method=e,this.time=0,this.response=n,this.options=r,this.asyncTimeout=null):this.options.error&&console.error("path and method cannot be empty")}function M(t,e,n,r){A(t)&&i(t,function(t){t.path&&(r&&0===t.path.indexOf("/")?t.path=f()+t.path:r&&/\w+:\/{2}.*/.test(t.path)?t.path=t.path:t.path=n.replace(/\/$/,"")+"/"+t.path.replace(/^\//,""),void 0!==t.response&&(t.method=String(t.method||"GET"),D.push(new $(t.path,t.method,t.response,e))),M(t.children,e,t.path))})}function j(t){var e=(t.getUrl()||"").split(/\?|#/)[0];return D.find(function(n){if((!n.jsonp||n.jsonp===t.jsonp)&&t.method.toLowerCase()===n.method.toLowerCase()){var r=!1,o=[],s=e.match(new RegExp(n.path.replace(/{[^{}]+}/g,function(t){return o.push(t.substring(1,t.length-1)),"([^/]+)"}).replace(/\/[*]{2}/g,"/.+").replace(/\/[*]{1}/g,"/[^/]+")+"/?$"));return n.pathVariable={},r=s&&s.length===o.length+1,n.options.pathVariable&&r&&o.length&&i(o,function(t,e){n.pathVariable[t]=function(t,e){if(t&&"auto"===e.options.pathVariable){if(!isNaN(t))return parseFloat(t);if("true"===t)return!0;if("false"===t)return!1}return t}(s[e+1],n)}),r}})}function H(t,e,n,r){var o=L({},X,r);return M(A(t)?(r=e,t):[{path:t,method:e,response:n}],o,o.baseURL,!0),H}function R(t){return function(e,n,r){return H(e,t,n,r)}}function k(t){return L(H,t)}var A=Array.isArray||function(t){return!!t&&t.constructor===Array},O=[{rules:[["yyyy",4],["yyy",3],["yy",2]]},{rules:[["MM",2],["M",1]],offset:-1},{rules:[["dd",2],["d",1]]},{rules:[["HH",2],["H",1]]},{rules:[["mm",2],["m",1]]},{rules:[["ss",2],["s",1]]},{rules:[["SSS",3],["SS",2],["S",1]]}],L=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t},C={random:{num:o,time:function(t,e,n){return t?e?o(s(t,n).getTime(),s(e,n).getTime()):s(t,n).getTime():t},date:function(t,e,n){return t?a(e?C.random.time(t,e):t,n):t},repeat:function(t,e,n){if(e=e||1,n=n||e,r(t)&&(t=t.split("")),t.length<n){for(var s=t;s.length<n;)s=s.concat(t);s.length=n,t=s}return l(t,o(e,n)).join("")}}},P={tStart:"__restArr=[]",tEnd:"return __restArr.join('');",contStart:"__restArr.push('",contEnd:"');\n",contTrimEnd:"'.trim());\n",cStart:"__restArr.push(",cEnd:");\n",simplifyRegExp:/__restArr\.push\('\s*'\);/g},q=/(.+)\|(array|random)\(([0-9-]+)\)$/;m.mixin=b,b(C),L(S.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:!1,response:"",responseText:"",open:function(t,e,r){this._mock=j(this._request),this._mock?(this.readyState=1,n(this.onreadystatechange)&&this.onreadystatechange()):(this._xhr=new XMLHttpRequest,this._xhr.open(t,e,r))},send:function(t){if(this._mock)this._mock.send(this,this._request);else{var e=this._xhr,r=this;e.withCredentials=this.withCredentials,e.onreadystatechange=function(){r.status=e.status,r.readyState=e.readyState,r.response=e.response,r.responseText=e.responseText,e.getAllResponseHeaders().trim(),n(r.onreadystatechange)&&r.onreadystatechange()},e.send(t)}},abort:function(t){var e=this;setTimeout(function(){e._mock?0!==e.readyState&&(clearTimeout(e._mock.asyncTimeout),e._mock.reply(e,e._request,t||{status:0,response:""}),e.readyState=0):e._xhr&&e._xhr.abort()})},setRequestHeader:function(t,e){this._xhr&&this._xhr.setRequestHeader(t,e)},getAllResponseHeaders:function(){if(this._xhr)return this._xhr.getAllResponseHeaders();var t="",e=this.responseHeaders;if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+": "+e[n]+"\n");return t}});var U="undefined"==typeof window?this:window,N={};L(T.prototype,{require:function(t){var e=this;return new Promise(function(n,r){if(0===t.indexOf("/")?t=f()+t:/\w+:\/{2}.*/.test(t)||(t=X.baseURL.replace(/\/$/,"")+"/"+t),N[t])n(w(e,t));else{var o=new XMLHttpRequest;o.open("GET",t,!0),o.onreadystatechange=function(){4===o.readyState&&(o.status<200&&o.status>=300&&X.error&&console.error("This relative module was not found: "+t),N[t]=o.responseText,n(w(e,t)))},o.send()}})}});var D=[],X={baseURL:function(){var t=location.pathname,e=function(t,e){if(n(t.lastIndexOf))return t.lastIndexOf(e);for(var r=t.length-1;r>=0;r--)if(e===t[r])return r;return-1}(t,"/")+1;return f()+(e===t.length?t:t.substring(0,e))}(),template:!1,pathVariable:!0,timeout:"20-400",headers:null,error:!0,log:!1};L($.prototype,{send:function(t,e){var n=this;return this.time=p(this.options.timeout),_(n,e).then(function(r){n.reply(t,e,r)})},reply:function(t,e,r){if(4!==t.readyState){var o=e.getUrl();t.status=r.status,t.responseText=t.response=r.body?JSON.stringify(r.body):"",t.responseHeaders=r.headers,t.readyState=4,this.options.error&&(t.status<200||t.status>=300)&&console.error(e.method+" "+o+" "+t.status),n(t.onreadystatechange)&&t.onreadystatechange(),this.options.log&&(console.info("[XEAjaxMock] URL: "+o+"\nMethod: "+e.method+" => Status: "+(r?r.status:"canceled")+" => Time: "+this.time+"ms"),console.info(r))}}});var V=m,F=H,G=R("GET"),I=R("POST"),J=R("PUT"),z=R("DELETE"),B=R("PATCH"),Y={template:m,Mock:F,JSONP:function(t,e,n){return H(t,"GET",e,L({jsonp:"callback"},n))},HEAD:R("HEAD"),GET:G,POST:I,PUT:J,DELETE:z,PATCH:B};return L(H,{mixin:k,setup:function(t){L(X,t)},install:function(t){t.setup({$fetch:x,$XMLHttpRequest:S,$jsonp:E})},version:"1.6.4",$name:"XEAjaxMock"}),k(Y),H});