/*!
 * xe-ajax-mock.js v1.2.1
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var h=Array.isArray||function(z){return Object.prototype.toString.call(z)==="[object Array]"};function c(z){return typeof z==="function"}function b(A,z){return A>=z?A:((A=A||0)+Math.round(Math.random()*((z||9)-A)))}var q=typeof window==="undefined"?this:window;var m=[];var p={baseURL:location.origin,timeout:"20-400",headers:null,error:true,log:true};function a(z,A){return new Promise(function(C,B){z.asyncTimeout=setTimeout(function(){Promise.resolve(c(z.xhr)?z.xhr(A,z.getResponse(null,200)):z.xhr).then(function(D){C(z.getResponse(D,200))}).catch(function(D){B(z.getResponse(D,500))})},z.time)})}function e(A,C,B,z){if(A&&C){this.path=A;this.method=C;this.time=0;this.xhr=B;this.options=z;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}Object.assign(e.prototype,{getResponse:function(A,z){if(A&&A.response!==undefined&&A.status!==undefined){A.headers=Object.assign({},p.headers,A.headers);return A}return{status:z,response:A,headers:Object.assign({},p.headers)}},send:function(A,B){var z=this;this.time=B.OPTIONS.timeout||t(this.options.timeout);return a(z,B).then(function(C){z.reply(A,B,C)})},reply:function(A,B,C){if(A.readyState!==4){var z=B.getUrl();A.status=C.status;A.responseText=A.response=C.response?JSON.stringify(C.response):"";A.responseHeaders=C.headers;A.readyState=4;if(this.options.error&&!B.OPTIONS.getPromiseStatus(A)){console.error(B.method+" "+z+" "+A.status)}if(c(A.onreadystatechange)){A.onreadystatechange()}if(this.options.log){console.info("XEMock URL: "+z+"\nMethod: "+B.method+" => Status: "+(C?C.status:"canceled")+" => Time: "+this.time+"ms");console.info(C.response)}}}});function t(z){var A=z.match(/(\d+)-(\d+)/);return A.length===3?b(parseInt(A[1]),parseInt(A[2])):0}function x(A){var z=(A.getUrl()||"").split(/\?|#/)[0];return m.find(function(C){if((C.jsonp?(C.jsonp===A.jsonp):true)&&A.method.toLowerCase()===C.method.toLowerCase()){var B=false;var D=[];var E=z.match(new RegExp(C.path.replace(/{[^{}]+}/g,function(F){D.push(F.substring(1,F.length-1));return"([^/]+)"})+"(/.*)?"));C.pathVariable={};B=E&&E.length===D.length+2&&!E[E.length-1];if(B&&D.length){D.forEach(function(G,F){C.pathVariable[G]=E[F+1]})}return B}})}function l(B,z,A){if(h(B)){B.forEach(function(C){if(C.path){if(!A){A=/\w+:\/{2}.*/.test(C.path)?"":z.baseURL}C.path=(A?A.replace(/\/$/,"")+"/":"")+C.path.replace(/^\//,"");if(C.xhr){C.method=String(C.method||"get");m.push(new e(C.path,C.method,C.xhr,z))}l(C.children,z,C.path)}})}}function w(z){this.XEMock_MATE=null;this.XEMock_XHR=null;this.XEMock_REQUEST=z}Object.assign(w.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(B,z,A){this.XEMock_MATE=x(this.XEMock_REQUEST);if(this.XEMock_MATE){this.readyState=1;if(c(this.onreadystatechange)){this.onreadystatechange()}}else{this.XEMock_XHR=new XMLHttpRequest();this.XEMock_XHR.open(B,z,A)}},send:function(z){if(this.XEMock_MATE){this.XEMock_MATE.send(this,this.XEMock_REQUEST)}else{this.XEMock_XHR.withCredentials=this.withCredentials;this.XEMock_XHR.send(z)}},abort:function(z){var A=this;setTimeout(function(){if(A.XEMock_MATE){if(A.readyState!==0){clearTimeout(A.XEMock_MATE.asyncTimeout);A.XEMock_MATE.reply(A,A.XEMock_REQUEST,z||{status:0,response:""});A.readyState=0}}else{A.XEMock_XHR.abort()}})},setRequestHeader:function(z,A){if(this.XEMock_XHR){this.XEMock_XHR.setRequestHeader(z,A)}},getAllResponseHeaders:function(){var z="";var B=this.responseHeaders;if(B){for(var A in B){if(B.hasOwnProperty(A)){z+=A+": "+B[A]+"\n"}}}return z}});function i(A,B){var z=x(B);if(z){z.time=B.OPTIONS.timeout||t(z.options.timeout);return a(z,B).then(function(D){var C=B.getUrl();if(B.OPTIONS.getPromiseStatus(D)){q[B.jsonpCallback](D.response);if(z.options.log){console.info("XEMock URL: "+C+"\nMethod: "+B.method+" => Status: "+(D?D.status:"canceled")+" => Time: "+z.time+"ms");console.info(D.response)}}else{A.onerror({type:"error"});if(z.options.error){console.error("JSONP "+C+" "+D.status)}}})}else{document.body.appendChild(A)}}function y(A,C,B,z){l(h(A)?(z=C,A):[{path:A,method:C,xhr:B}],Object.assign({},p,z));return y}function n(z){Object.assign(p,z)}function k(z){z.setup({getXMLHttpRequest:function(A){return new w(A)},sendJSONP:i,sendEndJSONP:function(){}})}function s(z){return function(B,C,A){return y(B,z,C,A)}}function j(A,B,z){return y(A,"GET",B,Object.assign({jsonp:"callback"},z))}var f=y;var v=s("GET");var d=s("POST");var g=s("PUT");var u=s("DELETE");var r=s("PATCH");function o(z){return Object.assign(y,z)}o({setup:n,install:k,JSONP:j,Mock:f,GET:v,POST:d,PUT:g,DELETE:u,PATCH:r});y.mixin=o;return y}));