/**
 * xe-ajax-mock.js v1.7.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XEAjaxMock=e()}(this,function(){"use strict";function t(t,e){var n=t.replace(/[\r\n\t]/g," ").replace(/{{\s*(.*?)\s*}}/g,function(t,e){return function(t){return j.contEnd+t+j.contStart}(j.cStart+e+j.cEnd)});try{return n="var "+j.tStart+";with(opts){"+j.contStart+n+j.contEnd+"};"+j.tEnd,new Function("opts",n.replace(j.simplifyRegExp,""))(e)}catch(t){console.error(t)}return t}function e(t,e){var r=null;if(r=n(t,new o({},e)),y.isObject(r)){var s=y.objectKeys(r);1!==s.length||"!return"!==s[0]&&"~"!==s[0]||(r=r[s[0]])}return r}function n(e,s){if(e){if(y.isArray(e))return r(e,s);if(y.isObject(e))return function(e,s){var i={};return y.objectEach(e,function(e,a){var u=a.match(E),c=null;if(u&&4===u.length){a=u[1];var h="random"===u[2].toLowerCase();if("array"===u[2].toLowerCase()||h){var f=y.getScopeNumber(t(u[3],s));if(y.isArray(e))e.length>f?(c=r(h?y.arraySample(e,f):e.slice(0,f),s),h&&1===c.length&&(c=c[0])):c=r(e,s);else{c=[];for(var l=0;l<f;l++){var p=new o({$parent:s,$obj:c,$value:null,$size:f,$index:l},s.$fns);c.push(n(e,p))}}}}else c=n(e,s),(u=a.match(/(.+)\|(number|boolean)$/))&&3===u.length&&(a=u[1],"number"===u[2].toLowerCase()?c=parseFloat(c):"boolean"===u[2].toLowerCase()&&(c="0"!==c&&Boolean(c)));i[a]=c}),i}(e,s);if(y.isString(e))return t(e,s)}return e}function r(t,e){var r=[];return y.arrayEach(t,function(s,i){var a=new o({$parent:e,$obj:t,$value:s,$size:t.length,$index:i},e.$fns);r.push(n(s,a))}),r}function o(t,e){this.$fns=e,y.objectAssign(this,e,t)}function s(){this._mock=null,this._xhr=null}function i(t){t.script.parentNode===document.body&&document.body.removeChild(t.script);try{delete w[t.jsonpCallback]}catch(e){w[t.jsonpCallback]=void 0}}function a(t,e,n){i(t),n(e)}function u(t,e){i(t),e(new TypeError("JSONP request failed"))}function c(t,e){try{return JSON.parse(M[e])}catch(t){}return M[e]}function h(t,n,r,o){r&&!0===t.options.template&&(r=e(r,{$pathVariable:t.pathVariable,$params:n.params||{},$body:n.body||{}})),r&&void 0!==r.body&&void 0!==r.status?(r.headers=y.objectAssign({},t.options.headers,r.headers),y.objectAssign(this,r)):(this.status=o,this.body=r,this.headers=y.objectAssign({},t.options.headers))}function f(t,e,n,r){var o=y.objectAssign({},b,r);return l(y.isArray(t)?(r=e,t):[{path:t,method:e,response:n}],o,o.baseURL,!0),f}function l(t,e,n,r){y.isArray(t)&&y.arrayEach(t,function(t){t.path&&(r&&0===t.path.indexOf("/")?t.path=y.getLocatOrigin()+t.path:r&&/\w+:\/{2}.*/.test(t.path)?t.path=t.path:t.path=n.replace(/\/$/,"")+"/"+t.path.replace(/^\//,""),void 0!==t.response&&(t.method=String(t.method||"GET"),v.push(new p(t.path,t.method,t.response,e))),l(t.children,e,t.path))})}function p(t,e,n,r){t&&e?(this.path=t,this.method=e,this.time=0,this.response=n,this.options=r,this.asyncTimeout=null):this.options.error&&console.error("path and method cannot be empty")}function g(t){return function(e,n,r){return f(e,t,n,r)}}var d=Object.prototype.toString,m=[{rules:[["yyyy",4],["yyy",3],["yy",2]]},{rules:[["MM",2],["M",1]],offset:-1},{rules:[["dd",2],["d",1]]},{rules:[["HH",2],["H",1]]},{rules:[["mm",2],["m",1]]},{rules:[["ss",2],["s",1]]},{rules:[["SSS",3],["SS",2],["S",1]]}],y={isArray:Array.isArray||function(t){return"[object Array]"===d.call(t)},isDate:function(t){return"[object Date]"===d.call(t)},isObject:function(t){return"object"==typeof t},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},getRandom:function(t,e){return t>=e?t:(t=t||0)+Math.round(Math.random()*((e||9)-t))},stringToDate:function(t,e){if(t){if(y.isDate(t))return t;if(!isNaN(t))return new Date(t);if(y.isString(t)){e=e||"yyyy-MM-dd HH:mm:ss.SSS";var n=[];return y.arrayEach(m,function(r){for(var o,s,i=0,a=r.rules,u=a.length;i<u;i++){if(o=a[i],(s=e.indexOf(o[0]))>-1){n.push(parseFloat(t.substring(s,s+o[1])||0)+(r.offset||0));break}i===u-1&&n.push(0)}}),new Date(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}}return"Invalid Date"},dateToString:function(t,e){if(t=y.stringToDate(t),y.isDate(t)){var n=["日","一","二","三","四","五","六"],r={"q+":Math.floor((t.getMonth()+3)/3),"M+":t.getMonth()+1,"E+":t.getDay(),"d+":t.getDate(),"H+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),S:t.getMilliseconds()},o=String(e||"yyyy-MM-dd HH:mm:ss").replace(/(y+)/,function(e){return(""+t.getFullYear()).substr(4-e.length)});for(var s in r)if(r.hasOwnProperty(s)){var i=""+r[s];o=o.replace(new RegExp("("+s+")"),function(t){return"q+"===s||"E+"===s?n[i]:1===t.length?i:("00"+i).substr(i.length)})}return o}return t},objectAssign:Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t},arrayEach:function(t,e,n){if(t.forEach)return t.forEach(e,n);for(var r=0,o=t.length||0;r<o;r++)e.call(n||global,t[r],r,t)},objectEach:function(t,e,n){for(var r in t)t.hasOwnProperty(r)&&e.call(n||this,t[r],r,t)},objectKeys:function(t){var e=[];if(t){if(Object.keys)return Object.keys(t);y.objectEach(t,function(t,n){e.push(n)})}return e},objectValues:function(t){if(Object.values)return t?Object.values(t):[];var e=[];return y.arrayEach(y.objectKeys(t),function(n){e.push(t[n])}),e},arrayShuffle:function(t){for(var e=[],n=y.objectValues(t),r=n.length-1;r>=0;r--){var o=r>0?y.getRandom(0,r):0;e.push(n[o]),n.splice(o,1)}return e},arraySample:function(t,e){var n=y.arrayShuffle(t);return 1===arguments.length?n[0]:(e<n.length&&(n.length=e||0),n)},getLocatOrigin:function(){return"undefined"==typeof location?"":location.origin||location.protocol+"//"+location.host},getBaseURL:function(){if("undefined"==typeof location)return"";var t=location.pathname,e=y.lastIndexOf(t,"/")+1;return y.getLocatOrigin()+(e===t.length?t:t.substring(0,e))},lastIndexOf:function(t,e){if(y.isFunction(t.lastIndexOf))return t.lastIndexOf(e);for(var n=t.length-1;n>=0;n--)if(e===t[n])return n;return-1},getScopeNumber:function(t){var e=String(t).match(/(\d+)-(\d+)/);return e&&3===e.length?y.getRandom(parseInt(e[1]),parseInt(e[2])):isNaN(t)?0:Number(t)}},b={baseURL:y.getBaseURL(),template:!1,pathVariable:!0,timeout:"20-400",headers:null,error:!0,log:!1},v=[],S={random:{num:y.getRandom,time:function(t,e,n){return t?e?y.getRandom(y.stringToDate(t,n).getTime(),y.stringToDate(e,n).getTime()):y.stringToDate(t,n).getTime():t},date:function(t,e,n){return t?e?y.dateToString(S.random.time(t,e),n):y.dateToString(t,n):t},repeat:function(t,e,n){if(e=e||1,n=n||e,y.isString(t)&&(t=t.split("")),t.length<n){for(var r=t;r.length<n;)r=r.concat(t);r.length=n,t=r}return y.arraySample(t,y.getRandom(e,n)).join("")}}},j={tStart:"__restArr=[]",tEnd:"return __restArr.join('');",contStart:"__restArr.push('",contEnd:"');\n",contTrimEnd:"'.trim());\n",cStart:"__restArr.push(",cEnd:");\n",simplifyRegExp:/__restArr\.push\('\s*'\);/g},E=/(.+)\|(array|random)\((.+)\)$/;e.mixin=function(t){return y.objectAssign(o.prototype,t)},e.mixin(S),y.objectAssign(s.prototype,{timeout:0,status:0,readyState:0,ontimeout:null,onreadystatechange:null,withCredentials:!1,response:"",responseText:"",open:function(t,e){this._mock=A.mateMockItem(this._request),this._mock?(this.readyState=1,y.isFunction(this.onreadystatechange)&&this.onreadystatechange()):(this._xhr=new XMLHttpRequest,this._xhr.open(t,e,!0))},send:function(t){var e=this,n=this._mock,r=this._request;if(n)return n.time=y.getScopeNumber(n.options.timeout),n.getMockResponse(r).then(function(t){e.readyState=4,e._updateResponse(r,t),e._triggerEvent("readystatechange"),e._triggerEvent("load"),n.outMockLog(r,t)});var o=this._xhr;o.withCredentials=this.withCredentials,o.responseType=this.responseType||"",o.onload=function(){e._triggerEvent("load")},o.onerror=function(){e._triggerEvent("error")},o.ontimeout=function(){e._triggerEvent("timeout")},o.onabort=function(){e._triggerEvent("abort")},o.onreadystatechange=function(){e.readyState=o.readyState,e._updateResponse(r,{status:o.status,body:o.response}),e._triggerEvent("readystatechange")},o.send(t)},abort:function(){var t=this,e=this._mock,n=this._request;setTimeout(function(){if(e){if(0!==t.readyState){clearTimeout(e.asyncTimeout);var r={status:0,body:""};t._updateResponse(t._request,r),t.readyState=4,t._triggerEvent("timeout"),t.readyState=0,e.outMockLog(n,r)}}else t._xhr&&t._xhr.abort()})},setRequestHeader:function(t,e){this._xhr&&this._xhr.setRequestHeader(t,e)},getAllResponseHeaders:function(){if(this._xhr)return this._xhr.getAllResponseHeaders();var t="",e=this._headers;if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+": "+e[n]+"\n");return t},_triggerEvent:function(t){y.isFunction(this["on"+t])&&this["on"+t]({type:t})},_updateResponse:function(t,e){var n=e.body||"";this.status=e.status,this._headers=e.headers,this._mock&&(y.isString(n)||(n=JSON.stringify(n))),"blob"===this.responseType?(this.response=n instanceof Blob?n:new Blob([n]),this.responseText=""):this.responseText=this.response=n}});var _=s,T=function(t,e){var n=e._request,r=A.mateMockItem(n);return r?(r.time=y.getScopeNumber(r.options.timeout),r.getMockResponse(n).then(function(t){return r.outMockLog(n,t),t})):self.fetch(t,e)},w="undefined"==typeof window?this:window,x=function(t,e){return new Promise(function(n,r){var o=A.mateMockItem(e);if(w[e.jsonpCallback]=function(t){a(e,{status:200,body:t},n)},o)return o.time=y.getScopeNumber(o.options.timeout),o.getMockResponse(o,e).then(function(t){t.status<200||t.status>=300?u(e,r):a(e,t.body,n),o.outMockLog(e,t)});var s=e.getUrl();t.type="text/javascript",t.src=s+(-1===s.indexOf("?")?"?":"&")+e.jsonp+"="+e.jsonpCallback,t.onerror=function(){u(e,r)},e.timeout&&setTimeout(function(){u(e,r)},e.timeout),document.body.appendChild(t)})},M={};y.objectAssign(h.prototype,{require:function(t){return new Promise(function(e,n){if(0===t.indexOf("/")?t=y.getLocatOrigin()+t:/\w+:\/{2}.*/.test(t)||(t=b.baseURL.replace(/\/$/,"")+"/"+t),M[t])e(c(0,t));else{var r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){4===r.readyState&&(r.status<200&&r.status>=300&&b.error&&console.error("This relative module was not found: "+t),M[t]=r.responseText,e(c(0,t)))},r.send()}})}});var A={mateMockItem:function(t){var e=(t.getUrl()||"").split(/\?|#/)[0];return v.find(function(n){if((!n.jsonp||n.jsonp===t.jsonp)&&t.method.toLowerCase()===n.method.toLowerCase()){var r=!1,o=[],s=e.match(new RegExp(n.path.replace(/{[^{}]+}/g,function(t){return o.push(t.substring(1,t.length-1)),"([^/]+)"}).replace(/\/[*]{2}/g,"/.+").replace(/\/[*]{1}/g,"/[^/]+")+"/?$"));return n.pathVariable={},r=s&&s.length===o.length+1,n.options.pathVariable&&r&&o.length&&y.arrayEach(o,function(t,e){n.pathVariable[t]=function(t,e){if(t&&"auto"===e.options.pathVariable){if(!isNaN(t))return parseFloat(t);if("true"===t)return!0;if("false"===t)return!1}return t}(s[e+1],n)}),r}})}};f.version="1.7.0",f.setup=function(t){y.objectAssign(b,t)},f.install=function(t){t.setup({$fetch:T,$XMLHttpRequest:_,$jsonp:x})},f.mixin=function(t){return y.objectAssign(f,t)},Object.assign(p.prototype,{getMockResponse:function(t){var e=this;return new Promise(function(n,r){e.asyncTimeout=setTimeout(function(){if(!t.$complete)return y.isFunction(e.response)?Promise.resolve(e.response(t,new h(e,t,null,200),e)).then(function(r){n(new h(e,t,r,200))}):Promise.resolve(e.response).then(function(r){n(new h(e,t,r,200))}).catch(function(n){r(new h(e,t,n,500))})},e.time)})},outMockLog:function(t,e){var n=t.getUrl();this.options.error&&(e.status<200||e.status>=300)&&console.error(t.method+" "+n+" "+e.status),this.options.log&&(console.info("[XEAjaxMock] URL: "+n+"\nMethod: "+t.method+" => Status: "+(e?e.status:"canceled")+" => Time: "+this.time+"ms"),console.info(e))}});var O={template:e,Mock:f,JSONP:function(t,e,n){return f(t,"GET",e,y.objectAssign({jsonp:"callback"},n))},GET:g("GET"),POST:g("POST"),PUT:g("PUT"),DELETE:g("DELETE"),PATCH:g("PATCH"),HEAD:g("HEAD")};return f.mixin(O),f});