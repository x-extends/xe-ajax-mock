/*!
 * xe-ajax-mock.js v1.2.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var h=Array.isArray||function(y){return Object.prototype.toString.call(y)==="[object Array]"};function c(y){return typeof y==="function"}function b(z,y){return z>=y?z:((z=z||0)+Math.round(Math.random()*((y||9)-z)))}var m=[];var p={baseURL:location.origin,timeout:"20-400",headers:null,error:true,log:true};function a(y,z){return new Promise(function(B,A){y.asyncTimeout=setTimeout(function(){Promise.resolve(c(y.xhr)?y.xhr(z,y.getResponse(null,200)):y.xhr).then(function(C){B(y.getResponse(C,200))}).catch(function(C){A(y.getResponse(C,500))})},y.time)})}function e(z,B,A,y){if(z&&B){this.path=z;this.method=B;this.time=0;this.xhr=A;this.options=y;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}Object.assign(e.prototype,{getResponse:function(z,y){if(z&&z.response!==undefined&&z.status!==undefined){z.headers=Object.assign({},p.headers,z.headers);return z}return{status:y,response:z,headers:Object.assign({},p.headers)}},send:function(z,A){var y=this;this.time=A.OPTIONS.timeout||s(this.options.timeout);return a(y,A).then(function(B){y.reply(z,A,B)})},reply:function(z,A,B){if(z.readyState!==4){var y=A.getUrl();z.status=B.status;z.responseText=z.response=B.response?JSON.stringify(B.response):"";z.responseHeaders=B.headers;z.readyState=4;if(this.options.error&&!A.OPTIONS.getPromiseStatus(z)){console.error(A.method+" "+y+" "+z.status)}if(c(z.onreadystatechange)){z.onreadystatechange()}if(this.options.log){console.info("XEMock URL: "+y+"\nMethod: "+A.method+" => Status: "+(B?B.status:"canceled")+" => Time: "+this.time+"ms");console.info(B.response)}}}});function s(y){var z=y.match(/(\d+)-(\d+)/);return z.length===3?b(parseInt(z[1]),parseInt(z[2])):0}function w(z){var y=(z.getUrl()||"").split(/\?|#/)[0];return m.find(function(B){if((B.jsonp?(B.jsonp===z.jsonp):true)&&z.method.toLowerCase()===B.method.toLowerCase()){var A=false;var C=[];var D=y.match(new RegExp(B.path.replace(/{[^{}]+}/g,function(E){C.push(E.substring(1,E.length-1));return"([^/]+)"})+"(/.*)?"));B.pathVariable={};A=D&&D.length===C.length+2&&!D[D.length-1];if(A&&C.length){C.forEach(function(F,E){B.pathVariable[F]=D[E+1]})}return A}})}function l(A,y,z){if(h(A)){A.forEach(function(B){if(B.path){if(!z){z=/\w+:\/{2}.*/.test(B.path)?"":y.baseURL}B.path=(z?z.replace(/\/$/,"")+"/":"")+B.path.replace(/^\//,"");if(B.xhr){B.method=String(B.method||"get");m.push(new e(B.path,B.method,B.xhr,y))}l(B.children,y,B.path)}})}}function v(y){this.XEMock_MATE=null;this.XEMock_XHR=null;this.XEMock_REQUEST=y}Object.assign(v.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,response:"",responseText:"",open:function(A,y,z){this.XEMock_MATE=w(this.XEMock_REQUEST);if(this.XEMock_MATE){this.readyState=1;if(c(this.onreadystatechange)){this.onreadystatechange()}}else{this.XEMock_XHR=new XMLHttpRequest();this.XEMock_XHR.open(A,y,z)}},send:function(y){if(this.XEMock_MATE){this.XEMock_MATE.send(this,this.XEMock_REQUEST)}else{this.XEMock_XHR.send(y)}},abort:function(y){var z=this;setTimeout(function(){if(z.XEMock_MATE){if(z.readyState!==0){clearTimeout(z.XEMock_MATE.asyncTimeout);z.XEMock_MATE.reply(z,z.XEMock_REQUEST,y||{status:0,response:""});z.readyState=0}}else{z.XEMock_XHR.abort()}})},setRequestHeader:function(y,z){if(this.XEMock_XHR){this.XEMock_XHR.setRequestHeader(y,z)}},getAllResponseHeaders:function(){var y="";var A=this.responseHeaders;if(A){for(var z in A){if(A.hasOwnProperty(z)){y+=z+": "+A[z]+"\n"}}}return y}});function i(z,A){var y=w(A);if(y){y.time=A.OPTIONS.timeout||s(y.options.timeout);return a(y,A).then(function(C){var B=A.getUrl();if(A.OPTIONS.getPromiseStatus(C)){global[A.jsonpCallback](C.response);if(y.options.log){console.info("XEMock URL: "+B+"\nMethod: "+A.method+" => Status: "+(C?C.status:"canceled")+" => Time: "+y.time+"ms");console.info(C.response)}}else{z.onerror({type:"error"});if(y.options.error){console.error("JSONP "+B+" "+C.status)}}})}else{document.body.appendChild(z)}}function x(z,B,A,y){l(h(z)?(y=B,z):[{path:z,method:B,xhr:A}],Object.assign({},p,y));return x}function n(y){Object.assign(p,y)}function k(y){y.setup({getXMLHttpRequest:function(z){return new v(z)},sendJSONP:i,sendEndJSONP:function(){}})}function r(y){return function(A,B,z){return x(A,y,B,z)}}function j(z,A,y){return x(z,"GET",A,Object.assign({jsonp:"callback"},y))}var f=x;var u=r("GET");var d=r("POST");var g=r("PUT");var t=r("DELETE");var q=r("PATCH");function o(y){return Object.assign(x,y)}o({setup:n,install:k,JSONP:j,Mock:f,GET:u,POST:d,PUT:g,DELETE:t,PATCH:q});x.mixin=o;return x}));