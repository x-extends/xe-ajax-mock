/*!
 * xe-ajax-mock.js v1.5.3
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var t=Array.isArray||function(L){return L?L.constructor===Array:false};function o(L){return typeof L==="function"}function u(M,L){return M>=L?M:((M=M||0)+Math.round(Math.random()*((L||9)-M)))}var b=Object.assign||function(P){for(var O,M=1,L=arguments.length;M<L;M++){O=arguments[M];for(var N in O){if(O.hasOwnProperty(N)){P[N]=O[N]}}}return P};function g(P,O,N){if(P.forEach){return P.forEach(O,N)}for(var M=0,L=P.length||0;M<L;M++){O.call(N||a,P[M],M,P)}}function c(){return location.origin||(location.protocol+"//"+location.host)}function m(){var L=location.pathname;var M=C(L,"/")+1;return c()+(M===L.length?L:L.substring(0,M))}function C(N,M){if(o(N.lastIndexOf)){return N.lastIndexOf(M)}else{for(var L=N.length-1;L>=0;L--){if(M===N[L]){return L}}}return -1}var a=typeof window==="undefined"?this:window;var y={};var w=[];var G={baseURL:m(),timeout:"20-400",headers:null,error:true,log:true};function k(L,N){L.body=null;try{L.body=JSON.parse(y[N])}catch(M){L.body=y[N]}return L}function D(M){var L=this;return new Promise(function(O,N){if(M.indexOf("/")===0){M=c()+M}else{if(!/\w+:\/{2}.*/.test(M)){M=G.baseURL.replace(/\/$/,"")+"/"+M}}if(y[M]){O(k(L,M))}else{var P=new XMLHttpRequest();P.open("GET",M,true);P.onreadystatechange=function(){if(P.readyState===4){if(P.status<200&&P.status>=300){if(G.error){console.error("This relative module was not found: "+M)}}y[M]=P.responseText;O(k(L,M))}};P.send()}})}function j(M,L){if(M&&M.body!==undefined&&M.status!==undefined){M.headers=b({},G.headers,M.headers);b(this,M)}else{this.status=L;this.body=M;this.headers=b({},G.headers)}}b(j.prototype,{require:D});function p(L,M){return new Promise(function(O,N){L.asyncTimeout=setTimeout(function(){if(o(L.response)){return O(L.response(M,new j(null,200),L))}return Promise.resolve(L.response).then(function(P){O(new j(P,200))}).catch(function(P){N(new j(P,500))})},L.time)})}function f(N,O,L,M){if(N&&O){this.path=N;this.method=O;this.time=0;this.response=L;this.options=M;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}b(f.prototype,{send:function(M,N){var L=this;this.time=N.timeout||l(this.options.timeout);return p(L,N).then(function(O){L.reply(M,N,O)})},reply:function(N,O,L){if(N.readyState!==4){var M=O.getUrl();N.status=L.status;N.responseText=N.response=L.body?JSON.stringify(L.body):"";N.responseHeaders=L.headers;N.readyState=4;if(this.options.error&&!O.getPromiseStatus(N)){console.error(O.method+" "+M+" "+N.status)}if(o(N.onreadystatechange)){N.onreadystatechange()}if(this.options.log){console.info("[XEAjaxMock] URL: "+M+"\nMethod: "+O.method+" => Status: "+(L?L.status:"canceled")+" => Time: "+this.time+"ms");console.info(L)}}}});function l(L){var M=L.match(/(\d+)-(\d+)/);return M.length===3?u(parseInt(M[1]),parseInt(M[2])):0}function F(M){var L=(M.getUrl()||"").split(/\?|#/)[0];return w.find(function(O){if((O.jsonp?(O.jsonp===M.jsonp):true)&&M.method.toLowerCase()===O.method.toLowerCase()){var N=false;var P=[];var Q=L.match(new RegExp(O.path.replace(/{[^{}]+}/g,function(R){P.push(R.substring(1,R.length-1));return"([^/]+)"})+"(/.*)?"));O.pathVariable={};N=Q&&Q.length===P.length+2&&!Q[Q.length-1];if(N&&P.length){g(P,function(S,R){O.pathVariable[S]=Q[R+1]})}return N}})}function A(N,L,M,O){if(t(N)){g(N,function(P){if(P.path){if(O&&P.path.indexOf("/")===0){P.path=c()+P.path}else{if(O&&/\w+:\/{2}.*/.test(P.path)){P.path=P.path}else{P.path=M.replace(/\/$/,"")+"/"+P.path.replace(/^\//,"")}}if(P.response){P.method=String(P.method||"GET");w.push(new f(P.path,P.method,P.response,L))}A(P.children,L,P.path)}})}}function z(L){this._mock=null;this._xhr=null;this._request=L}b(z.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(N,L,M){this._mock=F(this._request);if(this._mock){this.readyState=1;if(o(this.onreadystatechange)){this.onreadystatechange()}}else{this._xhr=new XMLHttpRequest();this._xhr.open(N,L,M)}},send:function(L){if(this._mock){this._mock.send(this,this._request)}else{var N=this._xhr;var M=this;if(this.ontimeout){N.ontimeout=this.ontimeout}N.withCredentials=this.withCredentials;N.onreadystatechange=function(){M.status=N.status;M.readyState=N.readyState;M.response=N.response;M.responseText=N.responseText;N.getAllResponseHeaders().trim();if(o(M.onreadystatechange)){M.onreadystatechange()}};N.send(L)}},abort:function(L){var M=this;setTimeout(function(){if(M._mock){if(M.readyState!==0){clearTimeout(M._mock.asyncTimeout);M._mock.reply(M,M._request,L||{status:0,response:""});M.readyState=0}}else{M._xhr.abort()}})},setRequestHeader:function(L,M){if(this._xhr){this._xhr.setRequestHeader(L,M)}},getAllResponseHeaders:function(){if(this._xhr){return this._xhr.getAllResponseHeaders()
}var L="";var N=this.responseHeaders;if(N){for(var M in N){if(N.hasOwnProperty(M)){L+=M+": "+N[M]+"\n"}}}return L}});function d(M,N){var L=F(N);if(L){L.time=N.timeout||l(L.options.timeout);return p(L,N).then(function(O){var P=N.getUrl();if(N.getPromiseStatus(O)){a[N.jsonpCallback](O.body);if(L.options.log){console.info("[XEAjaxMock] URL: "+P+"\nMethod: "+N.method+" => Status: "+(O?O.status:"canceled")+" => Time: "+L.time+"ms");console.info(O)}}else{M.onerror({type:"error"});if(L.options.error){console.error("JSONP "+P+" "+O.status)}}})}else{document.body.appendChild(M)}}function H(M,N){var L=F(N);if(!L){document.body.removeChild(M)}}function v(O,P,L,M){var N=b({},G,M);A(t(O)?(M=P,O):[{path:O,method:P,response:L}],N,N.baseURL,true);return v}function h(L){b(G,L)}function x(L){L.setup({getXMLHttpRequest:function(M){return new z(M)},sendJSONP:d,sendEndJSONP:H});if(G.log){console.info("[XEAjax] Ready. Detected XEAjaxMock v"+I)}}function K(L){return function(O,M,N){return v(O,L,M,N)}}function r(N,L,M){return v(N,"GET",L,b({jsonp:"callback"},M))}var n=v;var q=K("GET");var E=K("POST");var e=K("PUT");var i=K("DELETE");var s=K("PATCH");var B=K("HEAD");var I="1.5.3";function J(L){return b(v,L)}J({setup:h,install:x,JSONP:r,Mock:n,GET:q,POST:E,PUT:e,DELETE:i,PATCH:s,HEAD:B,version:I});v.mixin=J;return v}));