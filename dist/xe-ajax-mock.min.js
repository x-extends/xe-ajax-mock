/*!
 * xe-ajax-mock.js v1.4.1
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){function c(y){return typeof y==="function"}function b(z,y){return z>=y?z:((z=z||0)+Math.round(Math.random()*((y||9)-z)))}var p=typeof window==="undefined"?this:window;var l=[];var o={baseURL:location.origin,timeout:"20-400",headers:null,error:true,log:true};function a(y,z){return new Promise(function(B,A){y.asyncTimeout=setTimeout(function(){Promise.resolve(c(y.response)?y.response(z,y.getResponse(null,200),y):y.response).then(function(C){B(y.getResponse(C,200))}).catch(function(C){A(y.getResponse(C,500))})},y.time)})}function e(A,B,y,z){if(A&&B){this.path=A;this.method=B;this.time=0;this.response=y;this.options=z;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}Object.assign(e.prototype,{getResponse:function(z,y){if(z&&z.body!==undefined&&z.status!==undefined){z.headers=Object.assign({},o.headers,z.headers);return z}return{status:y,body:z,headers:Object.assign({},o.headers)}},send:function(z,A){var y=this;this.time=A.timeout||s(this.options.timeout);return a(y,A).then(function(B){y.reply(z,A,B)})},reply:function(A,B,y){if(A.readyState!==4){var z=B.getUrl();A.status=y.status;A.responseText=A.response=y.body?JSON.stringify(y.body):"";A.responseHeaders=y.headers;A.readyState=4;if(this.options.error&&!B.getPromiseStatus(A)){console.error(B.method+" "+z+" "+A.status)}if(c(A.onreadystatechange)){A.onreadystatechange()}if(this.options.log){console.info("XEMock URL: "+z+"\nMethod: "+B.method+" => Status: "+(y?y.status:"canceled")+" => Time: "+this.time+"ms");console.info(y.body)}}}});function s(y){var z=y.match(/(\d+)-(\d+)/);return z.length===3?b(parseInt(z[1]),parseInt(z[2])):0}function w(z){var y=(z.getUrl()||"").split(/\?|#/)[0];return l.find(function(B){if((B.jsonp?(B.jsonp===z.jsonp):true)&&z.method.toLowerCase()===B.method.toLowerCase()){var A=false;var C=[];var D=y.match(new RegExp(B.path.replace(/{[^{}]+}/g,function(E){C.push(E.substring(1,E.length-1));return"([^/]+)"})+"(/.*)?"));B.pathVariable={};A=D&&D.length===C.length+2&&!D[D.length-1];if(A&&C.length){C.forEach(function(F,E){B.pathVariable[F]=D[E+1]})}return A}})}function k(A,y,z){if(Array.isArray(A)){A.forEach(function(B){if(B.path){if(!z){z=/\w+:\/{2}.*/.test(B.path)?"":y.baseURL}B.path=(z?z.replace(/\/$/,"")+"/":"")+B.path.replace(/^\//,"");if(B.response){B.method=String(B.method||"get");l.push(new e(B.path,B.method,B.response,y))}k(B.children,y,B.path)}})}}function v(y){this.XEMock_MATE=null;this.XEMock_XHR=null;this.XEMock_REQUEST=y}Object.assign(v.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(A,y,z){this.XEMock_MATE=w(this.XEMock_REQUEST);if(this.XEMock_MATE){this.readyState=1;if(c(this.onreadystatechange)){this.onreadystatechange()}}else{this.XEMock_XHR=new XMLHttpRequest();this.XEMock_XHR.open(A,y,z)}},send:function(y){if(this.XEMock_MATE){this.XEMock_MATE.send(this,this.XEMock_REQUEST)}else{this.XEMock_XHR.withCredentials=this.withCredentials;this.XEMock_XHR.send(y)}},abort:function(y){var z=this;setTimeout(function(){if(z.XEMock_MATE){if(z.readyState!==0){clearTimeout(z.XEMock_MATE.asyncTimeout);z.XEMock_MATE.reply(z,z.XEMock_REQUEST,y||{status:0,response:""});z.readyState=0}}else{z.XEMock_XHR.abort()}})},setRequestHeader:function(y,z){if(this.XEMock_XHR){this.XEMock_XHR.setRequestHeader(y,z)}},getAllResponseHeaders:function(){var y="";var A=this.responseHeaders;if(A){for(var z in A){if(A.hasOwnProperty(z)){y+=z+": "+A[z]+"\n"}}}return y}});function h(z,A){var y=w(A);if(y){y.time=A.timeout||s(y.options.timeout);return a(y,A).then(function(B){var C=A.getUrl();if(A.getPromiseStatus(B)){p[A.jsonpCallback](B.body);if(y.options.log){console.info("XEMock URL: "+C+"\nMethod: "+A.method+" => Status: "+(B?B.status:"canceled")+" => Time: "+y.time+"ms");console.info(B.body)}}else{z.onerror({type:"error"});if(y.options.error){console.error("JSONP "+C+" "+B.status)}}})}else{document.body.appendChild(z)}}function x(A,B,y,z){k(Array.isArray(A)?(z=B,A):[{path:A,method:B,response:y}],Object.assign({},o,z));return x}function m(y){Object.assign(o,y)}function j(y){y.setup({getXMLHttpRequest:function(z){return new v(z)},sendJSONP:h,sendEndJSONP:function(){}})}function r(y){return function(B,z,A){return x(B,y,z,A)}}function i(A,y,z){return x(A,"GET",y,Object.assign({jsonp:"callback"},z))}var f=x;var u=r("GET");var d=r("POST");var g=r("PUT");var t=r("DELETE");var q=r("PATCH");function n(y){return Object.assign(x,y)}n({setup:m,install:j,JSONP:i,Mock:f,GET:u,POST:d,PUT:g,DELETE:t,PATCH:q});x.mixin=n;return x}));