/**
 * xe-ajax-mock.js v1.7.7
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XEAjaxMock=e()}(this,function(){"use strict";var e=Object.prototype.toString,t=[{rules:[["yyyy",4],["yyy",3],["yy",2]]},{rules:[["MM",2],["M",1]],offset:-1},{rules:[["dd",2],["d",1]]},{rules:[["HH",2],["H",1]]},{rules:[["mm",2],["m",1]]},{rules:[["ss",2],["s",1]]},{rules:[["SSS",3],["SS",2],["S",1]]}],h={isArray:Array.isArray||function(t){return"[object Array]"===e.call(t)},isDate:function(t){return"[object Date]"===e.call(t)},isObject:function(t){return"object"==typeof t},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},getRandom:function(t,e){return e<=t?t:(t=t||0)+Math.round(Math.random()*((e||9)-t))},toStringDate:function(i,a){if(i){if(h.isDate(i))return i;if(!isNaN(i))return new Date(i);if(h.isString(i)){a=a||"yyyy-MM-dd HH:mm:ss.SSS";var u=[];return h.arrayEach(t,function(t){for(var e,n,r=0,o=t.rules,s=o.length;r<s;r++){if(e=o[r],-1<(n=a.indexOf(e[0]))){u.push(parseFloat(i.substring(n,n+e[1])||0)+(t.offset||0));break}r===s-1&&u.push(0)}}),new Date(u[0],u[1],u[2],u[3],u[4],u[5],u[6])}}return"Invalid Date"},toDateString:function(e,t){if(e=h.toStringDate(e),h.isDate(e)){var n=["日","一","二","三","四","五","六"],r={"q+":Math.floor((e.getMonth()+3)/3),"M+":e.getMonth()+1,"E+":e.getDay(),"d+":e.getDate(),"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),S:e.getMilliseconds()},o=String(t||"yyyy-MM-dd HH:mm:ss").replace(/(y+)/,function(t){return(""+e.getFullYear()).substr(4-t.length)});for(var s in r)if(r.hasOwnProperty(s)){var i=""+r[s];o=o.replace(new RegExp("("+s+")"),function(t){return"q+"===s||"E+"===s?n[i]:1===t.length?i:("00"+i).substr(i.length)})}return o}return e},objectAssign:Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])e.hasOwnProperty(o)&&(t[o]=e[o]);return t},arrayEach:function(t,e,n){if(t.forEach)return t.forEach(e,n);for(var r=0,o=t.length||0;r<o;r++)e.call(n||global,t[r],r,t)},arrayFind:function(t,e,n){if(t.find)return t.find(e,n);for(var r=0,o=t.length||0;r<o;r++)if(e.call(n||global,t[r],r,t))return t[r]},objectEach:function(t,e,n){for(var r in t)t.hasOwnProperty(r)&&e.call(n||this,t[r],r,t)},objectKeys:function(t){var n=[];if(t){if(Object.keys)return Object.keys(t);h.objectEach(t,function(t,e){n.push(e)})}return n},objectValues:function(e){if(Object.values)return e?Object.values(e):[];var n=[];return h.arrayEach(h.objectKeys(e),function(t){n.push(e[t])}),n},arrayShuffle:function(t){for(var e=[],n=h.objectValues(t),r=n.length-1;0<=r;r--){var o=0<r?h.getRandom(0,r):0;e.push(n[o]),n.splice(o,1)}return e},arraySample:function(t,e){var n=h.arrayShuffle(t);return 1===arguments.length?n[0]:(e<n.length&&(n.length=e||0),n)},getLocatOrigin:function(){return"undefined"==typeof location?"":location.origin||location.protocol+"//"+location.host},getBaseURL:function(){if("undefined"==typeof location)return"";var t=location.pathname,e=h.lastIndexOf(t,"/")+1;return h.getLocatOrigin()+(e===t.length?t:t.substring(0,e))},lastIndexOf:function(t,e){if(h.isFunction(t.lastIndexOf))return t.lastIndexOf(e);for(var n=t.length-1;0<=n;n--)if(e===t[n])return n;return-1},getScopeNumber:function(t){var e=String(t).match(/(\d+)-(\d+)/);return e&&3===e.length?h.getRandom(parseInt(e[1]),parseInt(e[2])):isNaN(t)?0:Number(t)}},s={baseURL:h.getBaseURL(),template:!1,pathVariable:!0,timeout:"20-400",headers:null,error:!0,log:!1},i=[],r={random:{num:h.getRandom,time:function(t,e,n){return t?e?h.getRandom(h.toStringDate(t,n).getTime(),h.toStringDate(e,n).getTime()):h.toStringDate(t,n).getTime():t},date:function(t,e,n){return t?e?h.toDateString(r.random.time(t,e),n):h.toDateString(t,n):t},repeat:function(t,e,n){if(e=e||1,n=n||e,h.isString(t)&&(t=t.split("")),t.length<n){for(var r=t;r.length<n;)r=r.concat(t);r.length=n,t=r}return h.arraySample(t,h.getRandom(e,n)).join("")}}},o={tStart:"__restArr=[]",tEnd:"return __restArr.join('');",contStart:"__restArr.push('",contEnd:"');\n",contTrimEnd:"'.trim());\n",cStart:"__restArr.push(",cEnd:");\n",simplifyRegExp:/__restArr\.push\('\s*'\);/g};function f(t,e){var n=t.replace(/[\r\n\t]/g," ").replace(/{{\s*(.*?)\s*}}/g,function(t,e){return n=o.cStart+e+o.cEnd,o.contEnd+n+o.contStart;var n});try{return n="var "+o.tStart+";with(opts){"+o.contStart+n+o.contEnd+"};"+o.tEnd,new Function("opts",n.replace(o.simplifyRegExp,""))(e)}catch(t){console.error(t)}return t}var l=/(.+)\|(array|random)\((.+)\)$/;function a(t,e){var n=null;if(n=p(t,new g({},e)),h.isObject(n)){var r=h.objectKeys(n);1!==r.length||"!return"!==r[0]&&"~"!==r[0]||(n=n[r[0]])}return n}function p(t,e){if(t){if(h.isArray(t))return d(t,e);if(h.isObject(t))return n=t,u=e,c={},h.objectEach(n,function(t,e){var n=e.match(l),r=null;if(n&&4===n.length){e=n[1];var o="random"===n[2].toLowerCase();if("array"===n[2].toLowerCase()||o){var s=h.getScopeNumber(f(n[3],u));if(h.isArray(t))t.length>s?(r=d(o?h.arraySample(t,s):t.slice(0,s),u),o&&1===r.length&&(r=r[0])):r=d(t,u);else{r=[];for(var i=0;i<s;i++){var a=new g({$parent:u,$obj:r,$value:null,$size:s,$index:i},u.$fns);r.push(p(t,a))}}}}else r=p(t,u),(n=e.match(/(.+)\|(number|boolean)$/))&&3===n.length&&(e=n[1],"number"===n[2].toLowerCase()?r=parseFloat(r):"boolean"===n[2].toLowerCase()&&(r="0"!==r&&Boolean(r)));c[e]=r}),c;if(h.isString(t))return f(t,e)}var n,u,c;return t}function d(r,o){var s=[];return h.arrayEach(r,function(t,e){var n=new g({$parent:o,$obj:r,$value:t,$size:r.length,$index:e},o.$fns);s.push(p(t,n))}),s}function g(t,e){this.$fns=e,h.objectAssign(this,e,t)}function n(){this._mock=null,this._xhr=null}a.mixin=function(t){return h.objectAssign(g.prototype,t)},a.mixin(r),h.objectAssign(n.prototype,{timeout:0,status:0,readyState:0,ontimeout:null,onreadystatechange:null,withCredentials:!1,response:"",responseText:"",open:function(t,e){this._mock=w.mateMockItem(this._request),this._mock?(this.readyState=1,h.isFunction(this.onreadystatechange)&&this.onreadystatechange()):(this._xhr=new XMLHttpRequest,this._xhr.open(t,e,!0))},send:function(t){var e=this,n=this._mock,r=this._request;if(n)return n.time=h.getScopeNumber(n.options.timeout),n.getMockResponse(r).then(function(t){e.readyState=4,e._updateResponse(r,t),e._triggerEvent("readystatechange"),e._triggerEvent("load"),n.outMockLog(r,t)});var o=this._xhr;o.withCredentials=this.withCredentials,o.responseType=this.responseType||"",o.onload=function(){e._triggerEvent("load")},o.onerror=function(){e._triggerEvent("error")},o.ontimeout=function(){e._triggerEvent("timeout")},o.onabort=function(){e._triggerEvent("abort")},o.onreadystatechange=function(){e.readyState=o.readyState,e._updateResponse(r,{status:o.status,body:o.response}),e._triggerEvent("readystatechange")},o.send(t)},abort:function(){var e=this,n=this._mock,r=this._request;setTimeout(function(){if(n){if(0!==e.readyState){clearTimeout(n.asyncTimeout);var t={status:0,body:""};e._updateResponse(e._request,t),e.readyState=4,e._triggerEvent("timeout"),e.readyState=0,n.outMockLog(r,t)}}else e._xhr&&e._xhr.abort()})},setRequestHeader:function(t,e){this._xhr&&this._xhr.setRequestHeader(t,e)},getAllResponseHeaders:function(){if(this._xhr)return this._xhr.getAllResponseHeaders();var t="",e=this._headers;if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+": "+e[n]+"\n");return t},_triggerEvent:function(t){h.isFunction(this["on"+t])&&this["on"+t]({type:t})},_updateResponse:function(t,e){var n=e.body||"";this.status=e.status,this._headers=e.headers,this._mock&&(h.isString(n)||(n=JSON.stringify(n))),"blob"===this.responseType?(this.response=n instanceof Blob?n:new Blob([n]),this.responseText=""):this.responseText=this.response=n}});var u={XEXMLHttpRequest:n};var c={sendJsonp:function(t,e){var n=e._request,r=w.mateMockItem(n);return r?(r.time=h.getScopeNumber(r.options.timeout),r.getMockResponse(n).then(function(t){return r.outMockLog(n,t),t})):self.fetch(t,e)}},m="undefined"==typeof window?this:window;function y(e){e.script.parentNode===document.body&&document.body.removeChild(e.script);try{delete m[e.jsonpCallback]}catch(t){m[e.jsonpCallback]=void 0}}function b(t,e,n){y(t),n(e)}function v(t,e){y(t),e(new TypeError("JSONP request failed"))}var S={sendJsonp:function(o,s){return new Promise(function(e,n){var r=w.mateMockItem(s);if(m[s.jsonpCallback]=function(t){b(s,{status:200,body:t},e)},r)return r.time=h.getScopeNumber(r.options.timeout),r.getMockResponse(r,s).then(function(t){t.status<200||300<=t.status?v(s,n):b(s,t.body,e),r.outMockLog(s,t)});var t=s.getUrl();o.type="text/javascript",o.src=t+(-1===t.indexOf("?")?"?":"&")+s.jsonp+"="+s.jsonpCallback,o.onerror=function(){v(s,n)},s.timeout&&setTimeout(function(){v(s,n)},s.timeout),document.body.appendChild(o)})}},E={};function j(t,e){try{return JSON.parse(E[e])}catch(t){}return E[e]}function _(t,e,n,r){n&&!0===t.options.template&&(n=a(n,{$pathVariable:t.pathVariable,$params:e.params||{},$body:e.body||{}})),n&&void 0!==n.body&&void 0!==n.status?(n.headers=h.objectAssign({},t.options.headers,n.headers),h.objectAssign(this,n)):(this.status=r,this.body=n,this.headers=h.objectAssign({},t.options.headers))}h.objectAssign(_.prototype,{require:function(r){return new Promise(function(t,e){if(0===r.indexOf("/")?r=h.getLocatOrigin()+r:/\w+:\/{2}.*/.test(r)||(r=s.baseURL.replace(/\/$/,"")+"/"+r),E[r])t(j(0,r));else{var n=new XMLHttpRequest;n.open("GET",r,!0),n.onreadystatechange=function(){4===n.readyState&&(n.status<200&&300<=n.status&&s.error&&console.error("This relative module was not found: "+r),E[r]=n.responseText,t(j(0,r)))},n.send()}})}});var w={mateMockItem:function(o){var s=(o.getUrl()||"").split(/\?|#/)[0];return h.arrayFind(i,function(n){if((!n.jsonp||n.jsonp===o.jsonp)&&o.method.toLowerCase()===n.method.toLowerCase()){var t,e=[],r=s.match(new RegExp(n.path.replace(/{[^{}]+}/g,function(t){return e.push(t.substring(1,t.length-1)),"([^/]+)"}).replace(/\/[*]{2}/g,"/.+").replace(/\/[*]{1}/g,"/[^/]+")+"/?$"));return n.pathVariable={},t=r&&r.length===e.length+1,n.options.pathVariable&&t&&e.length&&h.arrayEach(e,function(t,e){n.pathVariable[t]=function(t,e){if(t&&"auto"===e.options.pathVariable){if(!isNaN(t))return parseFloat(t);if("true"===t)return!0;if("false"===t)return!1}return t}(r[e+1],n)}),t}})}};function x(t,e,n,r){var o=h.objectAssign({},s,r);return function e(t,n,r,o){h.isArray(t)&&h.arrayEach(t,function(t){t.path&&(o&&0===t.path.indexOf("/")?t.path=h.getLocatOrigin()+t.path:o&&/\w+:\/{2}.*/.test(t.path)||(t.path=r.replace(/\/$/,"")+"/"+t.path.replace(/^\//,"")),void 0!==t.response&&(t.method=String(t.method||"GET"),i.push(new M(t.path,t.method,t.response,n))),e(t.children,n,t.path))})}(h.isArray(t)?(r=e,t):[{path:t,method:e,response:n}],o,o.baseURL,!0),x}function M(t,e,n,r){t&&e?(this.path=t,this.method=e,this.time=0,this.response=n,this.options=r,this.asyncTimeout=null):this.options.error&&console.error("path and method cannot be empty")}function T(r){return function(t,e,n){return x(t,r,e,n)}}x.setup=function(t){h.objectAssign(s,t)},x.install=function(t){t.setup({$fetch:c.sendJsonp,$XMLHttpRequest:u.XEXMLHttpRequest,$jsonp:S.sendJsonp})},x.mixin=function(t){return h.objectAssign(x,t)},Object.assign(M.prototype,{getMockResponse:function(r){var o=this;return new Promise(function(e,n){o.asyncTimeout=setTimeout(function(){if(!r.$complete)return h.isFunction(o.response)?Promise.resolve(o.response(r,new _(o,r,null,200),o)).then(function(t){e(new _(o,r,t,200))}):Promise.resolve(o.response).then(function(t){e(new _(o,r,t,200))}).catch(function(t){n(new _(o,r,t,500))})},o.time)})},outMockLog:function(t,e){var n=t.getUrl();this.options.error&&(e.status<200||300<=e.status)&&console.error(t.method+" "+n+" "+e.status),this.options.log&&(console.info("[XEAjaxMock] URL: "+n+"\nMethod: "+t.method+" => Status: "+(e?e.status:"canceled")+" => Time: "+this.time+"ms"),console.info(e))}});var A={template:a,Mock:x,JSONP:function(t,e,n){return x(t,"GET",e,h.objectAssign({jsonp:"callback"},n))},GET:T("GET"),POST:T("POST"),PUT:T("PUT"),DELETE:T("DELETE"),PATCH:T("PATCH"),HEAD:T("HEAD")};return x.mixin(A),x});