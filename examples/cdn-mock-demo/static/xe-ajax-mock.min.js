/*!
 * xe-ajax-mock.js v1.4.8
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var m=Array.isArray||function(J){return J?J.constructor===Array:false};function d(J){return typeof J==="function"}function b(K,J){return K>=J?K:((K=K||0)+Math.round(Math.random()*((J||9)-K)))}var I=Object.assign||function(N){for(var M,K=1,J=arguments.length;K<J;K++){M=arguments[K];for(var L in M){if(M.hasOwnProperty(L)){N[L]=M[L]}}}return N};function u(N,M,L){if(N.forEach){return N.forEach(M,L)}for(var K=0,J=N.length||0;K<J;K++){M.call(L||x,N[K],K,N)}}function n(){var J=location.pathname;var K=A(J,"/")+1;return location.origin+(K===J.length?J:J.substring(0,K))}function A(L,K){if(d(L.lastIndexOf)){return L.lastIndexOf(K)}else{for(var J=L.length-1;J>=0;J--){if(K===L[J]){return J}}}return -1}var x=typeof window==="undefined"?this:window;var c={};var t=[];var w={baseURL:n(),timeout:"20-400",headers:null,error:true,log:true};function i(J,L){J.body=null;try{J.body=JSON.parse(c[L])}catch(K){J.body=c[L]}return J}function k(K){var J=this;return new Promise(function(M,L){if(c[K]){M(i(J,K))}else{var N=new XMLHttpRequest();N.open("GET",K,true);N.onreadystatechange=function(){if(N.readyState===4){if(N.status<200&&N.status>=300){if(w.error){console.error("This relative module was not found: "+K)}}c[K]=N.responseText;M(i(J,K))}};N.send()}})}function e(K,J){if(K&&K.body!==undefined&&K.status!==undefined){K.headers=I({},w.headers,K.headers);I(this,K)}else{this.status=J;this.body=K;this.headers=I({},w.headers)}}I(e.prototype,{require:k});function a(J,K){return new Promise(function(M,L){J.asyncTimeout=setTimeout(function(){if(d(J.response)){return M(J.response(K,new e(null,200),J))}return Promise.resolve(J.response).then(function(N){M(new e(N,200))}).catch(function(N){L(new e(N,500))})},J.time)})}function h(L,M,J,K){if(L&&M){this.path=L;this.method=M;this.time=0;this.response=J;this.options=K;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}I(h.prototype,{send:function(K,L){var J=this;this.time=L.timeout||C(this.options.timeout);return a(J,L).then(function(M){J.reply(K,L,M)})},reply:function(L,M,J){if(L.readyState!==4){var K=M.getUrl();L.status=J.status;L.responseText=L.response=J.body?JSON.stringify(J.body):"";L.responseHeaders=J.headers;L.readyState=4;if(this.options.error&&!M.getPromiseStatus(L)){console.error(M.method+" "+K+" "+L.status)}if(d(L.onreadystatechange)){L.onreadystatechange()}if(this.options.log){console.info("[XEAjaxMock] URL: "+K+"\nMethod: "+M.method+" => Status: "+(J?J.status:"canceled")+" => Time: "+this.time+"ms");console.info(J.body)}}}});function C(J){var K=J.match(/(\d+)-(\d+)/);return K.length===3?b(parseInt(K[1]),parseInt(K[2])):0}function G(K){var J=(K.getUrl()||"").split(/\?|#/)[0];return t.find(function(M){if((M.jsonp?(M.jsonp===K.jsonp):true)&&K.method.toLowerCase()===M.method.toLowerCase()){var L=false;var N=[];var O=J.match(new RegExp(M.path.replace(/{[^{}]+}/g,function(P){N.push(P.substring(1,P.length-1));return"([^/]+)"})+"(/.*)?"));M.pathVariable={};L=O&&O.length===N.length+2&&!O[O.length-1];if(L&&N.length){u(N,function(Q,P){M.pathVariable[Q]=O[P+1]})}return L}})}function s(L,J,K){if(m(L)){u(L,function(M){if(M.path){if(!K){K=/\w+:\/{2}.*/.test(M.path)?"":J.baseURL}M.path=(K?K.replace(/\/$/,"")+"/":"")+M.path.replace(/^\//,"");if(M.response){M.method=String(M.method||"get");t.push(new h(M.path,M.method,M.response,J))}s(M.children,J,M.path)}})}}function F(J){this._mock=null;this._xhr=null;this._request=J}I(F.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(L,J,K){this._mock=G(this._request);if(this._mock){this.readyState=1;if(d(this.onreadystatechange)){this.onreadystatechange()}}else{this._xhr=new XMLHttpRequest();this._xhr.open(L,J,K)}},send:function(J){if(this._mock){this._mock.send(this,this._request)}else{var L=this._xhr;var K=this;if(this.ontimeout){L.ontimeout=this.ontimeout}L.withCredentials=this.withCredentials;L.onreadystatechange=function(){K.status=L.status;K.readyState=L.readyState;K.response=L.response;K.responseText=L.responseText;L.getAllResponseHeaders().trim();if(d(K.onreadystatechange)){K.onreadystatechange()}};L.send(J)}},abort:function(J){var K=this;setTimeout(function(){if(K._mock){if(K.readyState!==0){clearTimeout(K._mock.asyncTimeout);K._mock.reply(K,K._request,J||{status:0,response:""});K.readyState=0}}else{K._xhr.abort()}})},setRequestHeader:function(J,K){if(this._xhr){this._xhr.setRequestHeader(J,K)}},getAllResponseHeaders:function(){if(this._xhr){return this._xhr.getAllResponseHeaders()}var J="";var L=this.responseHeaders;if(L){for(var K in L){if(L.hasOwnProperty(K)){J+=K+": "+L[K]+"\n"}}}return J}});function o(K,L){var J=G(L);if(J){J.time=L.timeout||C(J.options.timeout);
return a(J,L).then(function(M){var N=L.getUrl();if(L.getPromiseStatus(M)){x[L.jsonpCallback](M.body);if(J.options.log){console.info("[XEAjaxMock] URL: "+N+"\nMethod: "+L.method+" => Status: "+(M?M.status:"canceled")+" => Time: "+J.time+"ms");console.info(M.body)}}else{K.onerror({type:"error"});if(J.options.error){console.error("JSONP "+N+" "+M.status)}}})}else{document.body.appendChild(K)}}function B(K,L){var J=G(L);if(!J){document.body.removeChild(K)}}function H(L,M,J,K){s(m(L)?(K=M,L):[{path:L,method:M,response:J}],I({},w,K));return H}function r(J){I(w,J)}function q(J){J.setup({getXMLHttpRequest:function(K){return new F(K)},sendJSONP:o,sendEndJSONP:B});if(w.log){console.info("[XEAjax] Ready. Detected XEAjaxMock v"+g)}}function z(J){return function(M,K,L){return H(M,J,K,L)}}function p(L,J,K){return H(L,"GET",J,I({jsonp:"callback"},K))}var j=H;var E=z("GET");var f=z("POST");var l=z("PUT");var D=z("DELETE");var y=z("PATCH");var g="1.4.8";function v(J){return I(H,J)}v({setup:r,install:q,JSONP:p,Mock:j,GET:E,POST:f,PUT:l,DELETE:D,PATCH:y,version:g});H.mixin=v;return H}));