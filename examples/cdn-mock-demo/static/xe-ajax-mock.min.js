/*!
 * xe-ajax-mock.js v1.4.7
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjaxMock=a())}(this,function(){var i=Array.isArray||function(F){return F?F.constructor===Array:false};function c(F){return typeof F==="function"}function b(G,F){return G>=F?G:((G=G||0)+Math.round(Math.random()*((F||9)-G)))}var E=Object.assign||function(J){for(var I,G=1,F=arguments.length;G<F;G++){I=arguments[G];for(var H in I){if(I.hasOwnProperty(H)){J[H]=I[H]}}}return J};function q(J,I,H){if(J.forEach){return J.forEach(I,H)}for(var G=0,F=J.length||0;G<F;G++){I.call(H||t,J[G],G,J)}}function j(){var F=location.pathname;var G=w(F,"/")+1;return location.origin+(G===F.length?F:F.substring(0,G))}function w(H,G){if(c(H.lastIndexOf)){return H.lastIndexOf(G)}else{for(var F=H.length-1;F>=0;F--){if(G===H[F]){return F}}}return -1}var t=typeof window==="undefined"?this:window;var p=[];var s={baseURL:j(),timeout:"20-400",headers:null,error:true,log:true};function a(F,G){return new Promise(function(I,H){F.asyncTimeout=setTimeout(function(){Promise.resolve(c(F.response)?F.response(G,F.getResponse(null,200),F):F.response).then(function(J){I(F.getResponse(J,200))})["catch"](function(J){H(F.getResponse(J,500))})},F.time)})}function f(H,I,F,G){if(H&&I){this.path=H;this.method=I;this.time=0;this.response=F;this.options=G;this.asyncTimeout=null}else{throw new TypeError("path and method cannot be empty")}}E(f.prototype,{getResponse:function(G,F){if(G&&G.body!==undefined&&G.status!==undefined){G.headers=E({},s.headers,G.headers);return G}return{status:F,body:G,headers:E({},s.headers)}},send:function(G,H){var F=this;this.time=H.timeout||y(this.options.timeout);return a(F,H).then(function(I){F.reply(G,H,I)})},reply:function(H,I,F){if(H.readyState!==4){var G=I.getUrl();H.status=F.status;H.responseText=H.response=F.body?JSON.stringify(F.body):"";H.responseHeaders=F.headers;H.readyState=4;if(this.options.error&&!I.getPromiseStatus(H)){console.error(I.method+" "+G+" "+H.status)}if(c(H.onreadystatechange)){H.onreadystatechange()}if(this.options.log){console.info("XEMock URL: "+G+"\nMethod: "+I.method+" => Status: "+(F?F.status:"canceled")+" => Time: "+this.time+"ms");console.info(F.body)}}}});function y(F){var G=F.match(/(\d+)-(\d+)/);return G.length===3?b(parseInt(G[1]),parseInt(G[2])):0}function C(G){var F=(G.getUrl()||"").split(/\?|#/)[0];return p.find(function(I){if((I.jsonp?(I.jsonp===G.jsonp):true)&&G.method.toLowerCase()===I.method.toLowerCase()){var H=false;var J=[];var K=F.match(new RegExp(I.path.replace(/{[^{}]+}/g,function(L){J.push(L.substring(1,L.length-1));return"([^/]+)"})+"(/.*)?"));I.pathVariable={};H=K&&K.length===J.length+2&&!K[K.length-1];if(H&&J.length){q(J,function(M,L){I.pathVariable[M]=K[L+1]})}return H}})}function o(H,F,G){if(i(H)){q(H,function(I){if(I.path){if(!G){G=/\w+:\/{2}.*/.test(I.path)?"":F.baseURL}I.path=(G?G.replace(/\/$/,"")+"/":"")+I.path.replace(/^\//,"");if(I.response){I.method=String(I.method||"get");p.push(new f(I.path,I.method,I.response,F))}o(I.children,F,I.path)}})}}function B(F){this._mock=null;this._xhr=null;this._request=F}E(B.prototype,{timeout:0,status:0,readyState:0,responseHeaders:null,ontimeout:null,onreadystatechange:null,withCredentials:false,response:"",responseText:"",open:function(H,F,G){this._mock=C(this._request);if(this._mock){this.readyState=1;if(c(this.onreadystatechange)){this.onreadystatechange()}}else{this._xhr=new XMLHttpRequest();this._xhr.open(H,F,G)}},send:function(F){if(this._mock){this._mock.send(this,this._request)}else{var H=this._xhr;var G=this;if(this.ontimeout){H.ontimeout=this.ontimeout}H.withCredentials=this.withCredentials;H.onreadystatechange=function(){G.status=H.status;G.readyState=H.readyState;G.response=H.response;G.responseText=H.responseText;H.getAllResponseHeaders().trim();if(c(G.onreadystatechange)){G.onreadystatechange()}};H.send(F)}},abort:function(F){var G=this;setTimeout(function(){if(G._mock){if(G.readyState!==0){clearTimeout(G._mock.asyncTimeout);G._mock.reply(G,G._request,F||{status:0,response:""});G.readyState=0}}else{G._xhr.abort()}})},setRequestHeader:function(F,G){if(this._xhr){this._xhr.setRequestHeader(F,G)}},getAllResponseHeaders:function(){if(this._xhr){return this._xhr.getAllResponseHeaders()}var F="";var H=this.responseHeaders;if(H){for(var G in H){if(H.hasOwnProperty(G)){F+=G+": "+H[G]+"\n"}}}return F}});function k(G,H){var F=C(H);if(F){F.time=H.timeout||y(F.options.timeout);return a(F,H).then(function(I){var J=H.getUrl();if(H.getPromiseStatus(I)){t[H.jsonpCallback](I.body);if(F.options.log){console.info("XEMock URL: "+J+"\nMethod: "+H.method+" => Status: "+(I?I.status:"canceled")+" => Time: "+F.time+"ms");console.info(I.body)}}else{G.onerror({type:"error"});if(F.options.error){console.error("JSONP "+J+" "+I.status)}}})}else{document.body.appendChild(G)}}function x(G,H){var F=C(H);if(!F){document.body.removeChild(G)
}}function D(H,I,F,G){o(i(H)?(G=I,H):[{path:H,method:I,response:F}],E({},s,G));return D}function n(F){E(s,F)}function m(F){F.setup({getXMLHttpRequest:function(G){return new B(G)},sendJSONP:k,sendEndJSONP:x});if(s.log){console.info("[XEAjax] Ready. Detected XEAjaxMock v"+e)}}function v(F){return function(I,G,H){return D(I,F,G,H)}}function l(H,F,G){return D(H,"GET",F,E({jsonp:"callback"},G))}var g=D;var A=v("GET");var d=v("POST");var h=v("PUT");var z=v("DELETE");var u=v("PATCH");var e="1.4.7";function r(F){return E(D,F)}r({setup:n,install:m,JSONP:l,Mock:g,GET:A,POST:d,PUT:h,DELETE:z,PATCH:u,version:e});D.mixin=r;return D}));